{"version":3,"sources":["webpack:///./node_modules/core-js/modules/_typed-array.js","webpack:///./node_modules/core-js/modules/_typed-buffer.js","webpack:///./node_modules/core-js/modules/es6.string.starts-with.js","webpack:///./node_modules/core-js/modules/_to-index.js","webpack:///./node_modules/core-js/modules/_typed.js","webpack:///./node_modules/core-js/modules/es6.string.repeat.js","webpack:///./node_modules/core-js/modules/es6.typed.data-view.js","webpack:///./node_modules/core-js/modules/es6.typed.uint8-array.js","webpack:///./node_modules/core-js/modules/_array-fill.js","webpack:///./node_modules/core-js/modules/_string-html.js","webpack:///./node_modules/@firebase/messaging/dist/index.esm.js","webpack:///./node_modules/@firebase/installations/dist/index.esm.js","webpack:///./node_modules/core-js/modules/_string-repeat.js","webpack:///./node_modules/idb/build/idb.js","webpack:///./node_modules/core-js/modules/es6.string.link.js","webpack:///./node_modules/core-js/modules/_array-copy-within.js"],"names":["LIBRARY","global","fails","$export","$typed","$buffer","ctx","anInstance","propertyDesc","hide","redefineAll","toInteger","toLength","toIndex","toAbsoluteIndex","toPrimitive","has","classof","isObject","toObject","isArrayIter","create","getPrototypeOf","gOPN","f","getIterFn","uid","wks","createArrayMethod","createArrayIncludes","speciesConstructor","ArrayIterators","Iterators","$iterDetect","setSpecies","arrayFill","arrayCopyWithin","$DP","$GOPD","dP","gOPD","RangeError","TypeError","Uint8Array","ArrayProto","Array","$ArrayBuffer","ArrayBuffer","$DataView","DataView","arrayForEach","arrayFilter","arraySome","arrayEvery","arrayFind","arrayFindIndex","arrayIncludes","arrayIndexOf","arrayValues","values","arrayKeys","keys","arrayEntries","entries","arrayLastIndexOf","lastIndexOf","arrayReduce","reduce","arrayReduceRight","reduceRight","arrayJoin","join","arraySort","sort","arraySlice","slice","arrayToString","toString","arrayToLocaleString","toLocaleString","ITERATOR","TAG","TYPED_CONSTRUCTOR","DEF_CONSTRUCTOR","ALL_CONSTRUCTORS","CONSTR","TYPED_ARRAY","TYPED","VIEW","$map","O","length","allocate","LITTLE_ENDIAN","Uint16Array","buffer","FORCED_SET","set","toOffset","it","BYTES","offset","validate","C","speciesFromList","list","fromList","index","result","addGetter","key","internal","get","this","_d","$from","source","i","step","iterator","aLen","arguments","mapfn","undefined","mapping","iterFn","call","next","done","push","value","$of","TO_LOCALE_BUG","$toLocaleString","apply","proto","copyWithin","target","start","every","callbackfn","fill","filter","find","predicate","findIndex","forEach","indexOf","searchElement","includes","separator","map","reverse","middle","Math","floor","some","comparefn","subarray","begin","end","$begin","byteOffset","BYTES_PER_ELEMENT","$slice","$set","arrayLike","src","len","$iterators","isTAIndex","String","$getDesc","$setDesc","desc","configurable","writable","enumerable","S","F","getOwnPropertyDescriptor","defineProperty","$TypedArrayPrototype$","constructor","module","exports","KEY","wrapper","CLAMPED","NAME","GETTER","SETTER","TypedArray","Base","TAC","FORCED","ABV","TypedArrayPrototype","addElement","that","data","v","o","getter","round","setter","$offset","$length","byteLength","klass","$len","b","l","e","iter","Function","prototype","concat","$nativeIterator","CORRECT_ITER_NAME","name","$iterator","G","W","of","from","P","DESCRIPTORS","setToStringTag","PROTOTYPE","WRONG_INDEX","Infinity","BaseBuffer","abs","pow","log","LN2","$BUFFER","$LENGTH","$OFFSET","packIEEE754","mLen","nBytes","m","c","eLen","eMax","eBias","rt","s","unpackIEEE754","nBits","NaN","unpackI32","bytes","packI8","packI16","packI32","packF64","packF32","view","isLittleEndian","intIndex","store","_b","pack","conversion","ArrayBufferProto","j","$setInt8","setInt8","getInt8","setUint8","bufferLength","getUint8","getInt16","getUint16","getInt32","getUint32","getFloat32","getFloat64","setInt16","setUint16","setInt32","setUint32","setFloat32","setFloat64","context","$startsWith","startsWith","searchString","min","search","number","Typed","TypedArrayConstructors","split","repeat","init","endPos","defined","quot","createHTML","string","tag","attribute","p1","replace","exec","test","toLowerCase","MessageType","ERROR_MAP","errorFactory","DEFAULT_PUBLIC_VAPID_KEY","ENDPOINT","isArrayBufferEqual","a","viewA","viewB","arrayBufferToBase64","arrayBuffer","uint8Version","btoa","fromCharCode","toBase64","SubscriptionManager","getToken","app","subscription","vapidKey","headers","body","subscribeOptions","responseData","err_1","message","_a","label","getHeaders","sent","getBody","method","JSON","stringify","trys","fetch","getEndpoint","json","errorInfo","error","token","updateToken","tokenDetails","updateOptions","err_2","fcmToken","deleteToken","unsubscribeOptions","err_3","options","projectId","authToken","installations","Headers","Accept","apiKey","p256dh","getKey","auth","web","endpoint","applicationPubKey","base64ToArrayBuffer","base64String","base64","rawData","atob","outputArray","charCodeAt","OLD_DB_NAME","OLD_OBJECT_STORE_NAME","cleanV1","request","indexedDB","open","onerror","_event","onsuccess","db","objectStoreNames","contains","objectStore","transaction","subscriptionManager","openCursorRequest","openCursor","event","console","warn","cursor","close","deleteDatabase","handleDb","DbInterface","dbPromise","createTransaction","getIndex","put","closeDatabase","runRequest","mode","getDb","objectStoreName","promisify","Promise","resolve","reject","oncomplete","_this","dbName","dbVersion","onupgradeneeded","onDbUpgrade","_super","TokenDetailsModel","oldVersion","createObjectStore","keyPath","createIndex","unique","cursorRequest_1","newValue","createTime","Date","now","fcmPushSet","update","cursorRequest_2","getTokenDetailsFromToken","validateInputs","getTokenDetailsFromSWScope","swScope","saveTokenDetails","fcmSenderId","details","input","VapidDetailsModel","getVapidFromSWScope","saveVapidDetails","deleteVapidDetails","BaseController","vapidDetailsModel","messagingSenderId","INTERNAL","tokenDetailsModel","currentPermission","swReg","publicVapidKey","pushSubscription","getNotificationPermission_","getSWRegistration_","getPublicVapidKey_","getPushSubscription","scope","manageExistingToken","getNewToken","isEndpointEqual","isAuthEqual","isP256dhEqual","isTokenStillValid","deleteTokenFromDB","updatedToken","allDetails","e_1","newToken","registration","pushManager","getSubscription","unsubscribe","swRegistration","subscribe","userVisibleOnly","applicationServerKey","requestPermission","useServiceWorker","_registration","usePublicVapidKey","_b64PublicKey","onMessage","_nextOrObserver","_error","_completed","onTokenRefresh","setBackgroundMessageHandler","_callback","all","Notification","permission","getTokenDetailsModel","getVapidDetailsModel","getSubscriptionManager","SwController","bgMessageHandler","self","addEventListener","onPush","onSubChange","onNotificationClick","waitUntil","onPush_","onSubChange_","onNotificationClick_","msgPayload","notificationDetails","notificationTitle","reg","actions","maxActions","err","hasVisibleClients_","sendMessageToWindowClients_","getNotificationData_","title","showNotification","link","windowClient","internalMsg","notification","action","stopImmediatePropagation","fcmOptions","click_action","location","origin","getWindowClient_","clients","openWindow","ms","setTimeout","focus","createNewMsg","NOTIFICATION_CLICKED","attemptToMessageClient_","notificationInformation","callback","url","parsedURL","clientList","suitableClient","URL","href","getClientList","client","postMessage","visibilityState","PUSH_MSG_RECEIVED","vapidKeyFromDatabase","matchAll","type","includeUncontrolled","msgType","msgData","firebaseMessagingType","firebaseMessagingData","instance","namespaceExports","WindowController","registrationToUse","publicVapidKeyToUse","messageObserver","tokenRefreshObserver","onMessageInternal","observer","onTokenRefreshInternal","setupSWMessageListener_","permissionResult","ServiceWorkerRegistration","publicKey","parsedKey","nextOrObserver","completed","waitForRegistrationToActivate_","serviceWorker","installing","waiting","active","state","stateChangeListener","removeEventListener","navigator","register","browserErrorMessage","then","eventType","messageType","Error","getEventType","analytics","logEvent","message_name","message_id","message_time","message_device_time","isSupported","hasOwnProperty","PushSubscription","cookieEnabled","window","registerService","PENDING_TIMEOUT_MS","PACKAGE_VERSION","INTERNAL_AUTH_VERSION","INSTALLATIONS_API_URL","TOKEN_EXPIRATION_BUFFER","ERROR_DESCRIPTION_MAP","ERROR_FACTORY","isServerError","code","extractAppConfig","getMissingValueError","configKeys_1","configKeys_1_1","keyName","e_1_1","appName","appId","valueName","getInstallationsEndpoint","extractAuthTokenInfoFromResponse","response","requestStatus","expiresIn","responseExpiresIn","Number","creationTime","getErrorFromResponse","requestName","responseJson","errorData","serverCode","serverMessage","serverStatus","status","getHeadersWithAuth","appConfig","refreshToken","append","getAuthorizationHeader","retryIfServerError","fn","createInstallation","fid","responseValue","authVersion","sdkVersion","ok","registrationStatus","sleep","VALID_FID_PATTERN","INVALID_FID","generateFid","fidByteArray","crypto","msCrypto","getRandomValues","array","substr","encode","DATABASE_NAME","DATABASE_VERSION","OBJECT_STORE_NAME","getDbPromise","upgradeDB","tx","complete","remove","updateFn","oldValue","getInstallationEntry","registrationPromise","installationEntry","oldEntry","clearTimedOutRequest","updateOrCreateInstallationEntry","entryWithPromise","onLine","registrationPromiseWithError","inProgressEntry","registrationTime","registeredInstallationEntry","registerInstallation","waitUntilFidRegistration","triggerRegistrationIfNecessary","entry","updateInstallationRequest","generateAuthToken","getGenerateAuthTokenEndpoint","installation","refreshAuthToken","forceRefresh","tokenPromise","isEntryRegistered","oldAuthToken","isAuthTokenExpired","isAuthTokenValid","updateAuthTokenRequest","waitUntilAuthTokenRequest","inProgressAuthToken","requestTime","makeAuthTokenRequestInProgressEntry","updatedInstallationEntry","fetchAuthTokenFromServer","completeInstallationRegistration","deleteInstallation","getDeleteEndpoint","registerInstallations","getId","_getId","_getToken","deleteInstallation$1","count","str","res","n","toArray","arr","promisifyRequest","promisifyRequestCall","obj","args","p","promisifyCursorRequestCall","Cursor","proxyProperties","ProxyClass","targetProp","properties","prop","Object","val","proxyRequestMethods","Constructor","proxyMethods","proxyCursorRequestMethods","Index","_index","_cursor","_request","ObjectStore","_store","Transaction","idbTransaction","_tx","onabort","UpgradeDB","_db","DB","IDBIndex","IDBCursor","methodName","IDBObjectStore","IDBTransaction","IDBDatabase","funcName","nativeObject","getAll","query","items","iterateCursor","openDb","version","upgradeCallback","deleteDb","factory","to","inc"],"mappings":"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","file":"18-eb9a32355de0d3668015.js","sourcesContent":["'use strict';\nif (require('./_descriptors')) {\n  var LIBRARY = require('./_library');\n  var global = require('./_global');\n  var fails = require('./_fails');\n  var $export = require('./_export');\n  var $typed = require('./_typed');\n  var $buffer = require('./_typed-buffer');\n  var ctx = require('./_ctx');\n  var anInstance = require('./_an-instance');\n  var propertyDesc = require('./_property-desc');\n  var hide = require('./_hide');\n  var redefineAll = require('./_redefine-all');\n  var toInteger = require('./_to-integer');\n  var toLength = require('./_to-length');\n  var toIndex = require('./_to-index');\n  var toAbsoluteIndex = require('./_to-absolute-index');\n  var toPrimitive = require('./_to-primitive');\n  var has = require('./_has');\n  var classof = require('./_classof');\n  var isObject = require('./_is-object');\n  var toObject = require('./_to-object');\n  var isArrayIter = require('./_is-array-iter');\n  var create = require('./_object-create');\n  var getPrototypeOf = require('./_object-gpo');\n  var gOPN = require('./_object-gopn').f;\n  var getIterFn = require('./core.get-iterator-method');\n  var uid = require('./_uid');\n  var wks = require('./_wks');\n  var createArrayMethod = require('./_array-methods');\n  var createArrayIncludes = require('./_array-includes');\n  var speciesConstructor = require('./_species-constructor');\n  var ArrayIterators = require('./es6.array.iterator');\n  var Iterators = require('./_iterators');\n  var $iterDetect = require('./_iter-detect');\n  var setSpecies = require('./_set-species');\n  var arrayFill = require('./_array-fill');\n  var arrayCopyWithin = require('./_array-copy-within');\n  var $DP = require('./_object-dp');\n  var $GOPD = require('./_object-gopd');\n  var dP = $DP.f;\n  var gOPD = $GOPD.f;\n  var RangeError = global.RangeError;\n  var TypeError = global.TypeError;\n  var Uint8Array = global.Uint8Array;\n  var ARRAY_BUFFER = 'ArrayBuffer';\n  var SHARED_BUFFER = 'Shared' + ARRAY_BUFFER;\n  var BYTES_PER_ELEMENT = 'BYTES_PER_ELEMENT';\n  var PROTOTYPE = 'prototype';\n  var ArrayProto = Array[PROTOTYPE];\n  var $ArrayBuffer = $buffer.ArrayBuffer;\n  var $DataView = $buffer.DataView;\n  var arrayForEach = createArrayMethod(0);\n  var arrayFilter = createArrayMethod(2);\n  var arraySome = createArrayMethod(3);\n  var arrayEvery = createArrayMethod(4);\n  var arrayFind = createArrayMethod(5);\n  var arrayFindIndex = createArrayMethod(6);\n  var arrayIncludes = createArrayIncludes(true);\n  var arrayIndexOf = createArrayIncludes(false);\n  var arrayValues = ArrayIterators.values;\n  var arrayKeys = ArrayIterators.keys;\n  var arrayEntries = ArrayIterators.entries;\n  var arrayLastIndexOf = ArrayProto.lastIndexOf;\n  var arrayReduce = ArrayProto.reduce;\n  var arrayReduceRight = ArrayProto.reduceRight;\n  var arrayJoin = ArrayProto.join;\n  var arraySort = ArrayProto.sort;\n  var arraySlice = ArrayProto.slice;\n  var arrayToString = ArrayProto.toString;\n  var arrayToLocaleString = ArrayProto.toLocaleString;\n  var ITERATOR = wks('iterator');\n  var TAG = wks('toStringTag');\n  var TYPED_CONSTRUCTOR = uid('typed_constructor');\n  var DEF_CONSTRUCTOR = uid('def_constructor');\n  var ALL_CONSTRUCTORS = $typed.CONSTR;\n  var TYPED_ARRAY = $typed.TYPED;\n  var VIEW = $typed.VIEW;\n  var WRONG_LENGTH = 'Wrong length!';\n\n  var $map = createArrayMethod(1, function (O, length) {\n    return allocate(speciesConstructor(O, O[DEF_CONSTRUCTOR]), length);\n  });\n\n  var LITTLE_ENDIAN = fails(function () {\n    // eslint-disable-next-line no-undef\n    return new Uint8Array(new Uint16Array([1]).buffer)[0] === 1;\n  });\n\n  var FORCED_SET = !!Uint8Array && !!Uint8Array[PROTOTYPE].set && fails(function () {\n    new Uint8Array(1).set({});\n  });\n\n  var toOffset = function (it, BYTES) {\n    var offset = toInteger(it);\n    if (offset < 0 || offset % BYTES) throw RangeError('Wrong offset!');\n    return offset;\n  };\n\n  var validate = function (it) {\n    if (isObject(it) && TYPED_ARRAY in it) return it;\n    throw TypeError(it + ' is not a typed array!');\n  };\n\n  var allocate = function (C, length) {\n    if (!(isObject(C) && TYPED_CONSTRUCTOR in C)) {\n      throw TypeError('It is not a typed array constructor!');\n    } return new C(length);\n  };\n\n  var speciesFromList = function (O, list) {\n    return fromList(speciesConstructor(O, O[DEF_CONSTRUCTOR]), list);\n  };\n\n  var fromList = function (C, list) {\n    var index = 0;\n    var length = list.length;\n    var result = allocate(C, length);\n    while (length > index) result[index] = list[index++];\n    return result;\n  };\n\n  var addGetter = function (it, key, internal) {\n    dP(it, key, { get: function () { return this._d[internal]; } });\n  };\n\n  var $from = function from(source /* , mapfn, thisArg */) {\n    var O = toObject(source);\n    var aLen = arguments.length;\n    var mapfn = aLen > 1 ? arguments[1] : undefined;\n    var mapping = mapfn !== undefined;\n    var iterFn = getIterFn(O);\n    var i, length, values, result, step, iterator;\n    if (iterFn != undefined && !isArrayIter(iterFn)) {\n      for (iterator = iterFn.call(O), values = [], i = 0; !(step = iterator.next()).done; i++) {\n        values.push(step.value);\n      } O = values;\n    }\n    if (mapping && aLen > 2) mapfn = ctx(mapfn, arguments[2], 2);\n    for (i = 0, length = toLength(O.length), result = allocate(this, length); length > i; i++) {\n      result[i] = mapping ? mapfn(O[i], i) : O[i];\n    }\n    return result;\n  };\n\n  var $of = function of(/* ...items */) {\n    var index = 0;\n    var length = arguments.length;\n    var result = allocate(this, length);\n    while (length > index) result[index] = arguments[index++];\n    return result;\n  };\n\n  // iOS Safari 6.x fails here\n  var TO_LOCALE_BUG = !!Uint8Array && fails(function () { arrayToLocaleString.call(new Uint8Array(1)); });\n\n  var $toLocaleString = function toLocaleString() {\n    return arrayToLocaleString.apply(TO_LOCALE_BUG ? arraySlice.call(validate(this)) : validate(this), arguments);\n  };\n\n  var proto = {\n    copyWithin: function copyWithin(target, start /* , end */) {\n      return arrayCopyWithin.call(validate(this), target, start, arguments.length > 2 ? arguments[2] : undefined);\n    },\n    every: function every(callbackfn /* , thisArg */) {\n      return arrayEvery(validate(this), callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n    },\n    fill: function fill(value /* , start, end */) { // eslint-disable-line no-unused-vars\n      return arrayFill.apply(validate(this), arguments);\n    },\n    filter: function filter(callbackfn /* , thisArg */) {\n      return speciesFromList(this, arrayFilter(validate(this), callbackfn,\n        arguments.length > 1 ? arguments[1] : undefined));\n    },\n    find: function find(predicate /* , thisArg */) {\n      return arrayFind(validate(this), predicate, arguments.length > 1 ? arguments[1] : undefined);\n    },\n    findIndex: function findIndex(predicate /* , thisArg */) {\n      return arrayFindIndex(validate(this), predicate, arguments.length > 1 ? arguments[1] : undefined);\n    },\n    forEach: function forEach(callbackfn /* , thisArg */) {\n      arrayForEach(validate(this), callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n    },\n    indexOf: function indexOf(searchElement /* , fromIndex */) {\n      return arrayIndexOf(validate(this), searchElement, arguments.length > 1 ? arguments[1] : undefined);\n    },\n    includes: function includes(searchElement /* , fromIndex */) {\n      return arrayIncludes(validate(this), searchElement, arguments.length > 1 ? arguments[1] : undefined);\n    },\n    join: function join(separator) { // eslint-disable-line no-unused-vars\n      return arrayJoin.apply(validate(this), arguments);\n    },\n    lastIndexOf: function lastIndexOf(searchElement /* , fromIndex */) { // eslint-disable-line no-unused-vars\n      return arrayLastIndexOf.apply(validate(this), arguments);\n    },\n    map: function map(mapfn /* , thisArg */) {\n      return $map(validate(this), mapfn, arguments.length > 1 ? arguments[1] : undefined);\n    },\n    reduce: function reduce(callbackfn /* , initialValue */) { // eslint-disable-line no-unused-vars\n      return arrayReduce.apply(validate(this), arguments);\n    },\n    reduceRight: function reduceRight(callbackfn /* , initialValue */) { // eslint-disable-line no-unused-vars\n      return arrayReduceRight.apply(validate(this), arguments);\n    },\n    reverse: function reverse() {\n      var that = this;\n      var length = validate(that).length;\n      var middle = Math.floor(length / 2);\n      var index = 0;\n      var value;\n      while (index < middle) {\n        value = that[index];\n        that[index++] = that[--length];\n        that[length] = value;\n      } return that;\n    },\n    some: function some(callbackfn /* , thisArg */) {\n      return arraySome(validate(this), callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n    },\n    sort: function sort(comparefn) {\n      return arraySort.call(validate(this), comparefn);\n    },\n    subarray: function subarray(begin, end) {\n      var O = validate(this);\n      var length = O.length;\n      var $begin = toAbsoluteIndex(begin, length);\n      return new (speciesConstructor(O, O[DEF_CONSTRUCTOR]))(\n        O.buffer,\n        O.byteOffset + $begin * O.BYTES_PER_ELEMENT,\n        toLength((end === undefined ? length : toAbsoluteIndex(end, length)) - $begin)\n      );\n    }\n  };\n\n  var $slice = function slice(start, end) {\n    return speciesFromList(this, arraySlice.call(validate(this), start, end));\n  };\n\n  var $set = function set(arrayLike /* , offset */) {\n    validate(this);\n    var offset = toOffset(arguments[1], 1);\n    var length = this.length;\n    var src = toObject(arrayLike);\n    var len = toLength(src.length);\n    var index = 0;\n    if (len + offset > length) throw RangeError(WRONG_LENGTH);\n    while (index < len) this[offset + index] = src[index++];\n  };\n\n  var $iterators = {\n    entries: function entries() {\n      return arrayEntries.call(validate(this));\n    },\n    keys: function keys() {\n      return arrayKeys.call(validate(this));\n    },\n    values: function values() {\n      return arrayValues.call(validate(this));\n    }\n  };\n\n  var isTAIndex = function (target, key) {\n    return isObject(target)\n      && target[TYPED_ARRAY]\n      && typeof key != 'symbol'\n      && key in target\n      && String(+key) == String(key);\n  };\n  var $getDesc = function getOwnPropertyDescriptor(target, key) {\n    return isTAIndex(target, key = toPrimitive(key, true))\n      ? propertyDesc(2, target[key])\n      : gOPD(target, key);\n  };\n  var $setDesc = function defineProperty(target, key, desc) {\n    if (isTAIndex(target, key = toPrimitive(key, true))\n      && isObject(desc)\n      && has(desc, 'value')\n      && !has(desc, 'get')\n      && !has(desc, 'set')\n      // TODO: add validation descriptor w/o calling accessors\n      && !desc.configurable\n      && (!has(desc, 'writable') || desc.writable)\n      && (!has(desc, 'enumerable') || desc.enumerable)\n    ) {\n      target[key] = desc.value;\n      return target;\n    } return dP(target, key, desc);\n  };\n\n  if (!ALL_CONSTRUCTORS) {\n    $GOPD.f = $getDesc;\n    $DP.f = $setDesc;\n  }\n\n  $export($export.S + $export.F * !ALL_CONSTRUCTORS, 'Object', {\n    getOwnPropertyDescriptor: $getDesc,\n    defineProperty: $setDesc\n  });\n\n  if (fails(function () { arrayToString.call({}); })) {\n    arrayToString = arrayToLocaleString = function toString() {\n      return arrayJoin.call(this);\n    };\n  }\n\n  var $TypedArrayPrototype$ = redefineAll({}, proto);\n  redefineAll($TypedArrayPrototype$, $iterators);\n  hide($TypedArrayPrototype$, ITERATOR, $iterators.values);\n  redefineAll($TypedArrayPrototype$, {\n    slice: $slice,\n    set: $set,\n    constructor: function () { /* noop */ },\n    toString: arrayToString,\n    toLocaleString: $toLocaleString\n  });\n  addGetter($TypedArrayPrototype$, 'buffer', 'b');\n  addGetter($TypedArrayPrototype$, 'byteOffset', 'o');\n  addGetter($TypedArrayPrototype$, 'byteLength', 'l');\n  addGetter($TypedArrayPrototype$, 'length', 'e');\n  dP($TypedArrayPrototype$, TAG, {\n    get: function () { return this[TYPED_ARRAY]; }\n  });\n\n  // eslint-disable-next-line max-statements\n  module.exports = function (KEY, BYTES, wrapper, CLAMPED) {\n    CLAMPED = !!CLAMPED;\n    var NAME = KEY + (CLAMPED ? 'Clamped' : '') + 'Array';\n    var GETTER = 'get' + KEY;\n    var SETTER = 'set' + KEY;\n    var TypedArray = global[NAME];\n    var Base = TypedArray || {};\n    var TAC = TypedArray && getPrototypeOf(TypedArray);\n    var FORCED = !TypedArray || !$typed.ABV;\n    var O = {};\n    var TypedArrayPrototype = TypedArray && TypedArray[PROTOTYPE];\n    var getter = function (that, index) {\n      var data = that._d;\n      return data.v[GETTER](index * BYTES + data.o, LITTLE_ENDIAN);\n    };\n    var setter = function (that, index, value) {\n      var data = that._d;\n      if (CLAMPED) value = (value = Math.round(value)) < 0 ? 0 : value > 0xff ? 0xff : value & 0xff;\n      data.v[SETTER](index * BYTES + data.o, value, LITTLE_ENDIAN);\n    };\n    var addElement = function (that, index) {\n      dP(that, index, {\n        get: function () {\n          return getter(this, index);\n        },\n        set: function (value) {\n          return setter(this, index, value);\n        },\n        enumerable: true\n      });\n    };\n    if (FORCED) {\n      TypedArray = wrapper(function (that, data, $offset, $length) {\n        anInstance(that, TypedArray, NAME, '_d');\n        var index = 0;\n        var offset = 0;\n        var buffer, byteLength, length, klass;\n        if (!isObject(data)) {\n          length = toIndex(data);\n          byteLength = length * BYTES;\n          buffer = new $ArrayBuffer(byteLength);\n        } else if (data instanceof $ArrayBuffer || (klass = classof(data)) == ARRAY_BUFFER || klass == SHARED_BUFFER) {\n          buffer = data;\n          offset = toOffset($offset, BYTES);\n          var $len = data.byteLength;\n          if ($length === undefined) {\n            if ($len % BYTES) throw RangeError(WRONG_LENGTH);\n            byteLength = $len - offset;\n            if (byteLength < 0) throw RangeError(WRONG_LENGTH);\n          } else {\n            byteLength = toLength($length) * BYTES;\n            if (byteLength + offset > $len) throw RangeError(WRONG_LENGTH);\n          }\n          length = byteLength / BYTES;\n        } else if (TYPED_ARRAY in data) {\n          return fromList(TypedArray, data);\n        } else {\n          return $from.call(TypedArray, data);\n        }\n        hide(that, '_d', {\n          b: buffer,\n          o: offset,\n          l: byteLength,\n          e: length,\n          v: new $DataView(buffer)\n        });\n        while (index < length) addElement(that, index++);\n      });\n      TypedArrayPrototype = TypedArray[PROTOTYPE] = create($TypedArrayPrototype$);\n      hide(TypedArrayPrototype, 'constructor', TypedArray);\n    } else if (!fails(function () {\n      TypedArray(1);\n    }) || !fails(function () {\n      new TypedArray(-1); // eslint-disable-line no-new\n    }) || !$iterDetect(function (iter) {\n      new TypedArray(); // eslint-disable-line no-new\n      new TypedArray(null); // eslint-disable-line no-new\n      new TypedArray(1.5); // eslint-disable-line no-new\n      new TypedArray(iter); // eslint-disable-line no-new\n    }, true)) {\n      TypedArray = wrapper(function (that, data, $offset, $length) {\n        anInstance(that, TypedArray, NAME);\n        var klass;\n        // `ws` module bug, temporarily remove validation length for Uint8Array\n        // https://github.com/websockets/ws/pull/645\n        if (!isObject(data)) return new Base(toIndex(data));\n        if (data instanceof $ArrayBuffer || (klass = classof(data)) == ARRAY_BUFFER || klass == SHARED_BUFFER) {\n          return $length !== undefined\n            ? new Base(data, toOffset($offset, BYTES), $length)\n            : $offset !== undefined\n              ? new Base(data, toOffset($offset, BYTES))\n              : new Base(data);\n        }\n        if (TYPED_ARRAY in data) return fromList(TypedArray, data);\n        return $from.call(TypedArray, data);\n      });\n      arrayForEach(TAC !== Function.prototype ? gOPN(Base).concat(gOPN(TAC)) : gOPN(Base), function (key) {\n        if (!(key in TypedArray)) hide(TypedArray, key, Base[key]);\n      });\n      TypedArray[PROTOTYPE] = TypedArrayPrototype;\n      if (!LIBRARY) TypedArrayPrototype.constructor = TypedArray;\n    }\n    var $nativeIterator = TypedArrayPrototype[ITERATOR];\n    var CORRECT_ITER_NAME = !!$nativeIterator\n      && ($nativeIterator.name == 'values' || $nativeIterator.name == undefined);\n    var $iterator = $iterators.values;\n    hide(TypedArray, TYPED_CONSTRUCTOR, true);\n    hide(TypedArrayPrototype, TYPED_ARRAY, NAME);\n    hide(TypedArrayPrototype, VIEW, true);\n    hide(TypedArrayPrototype, DEF_CONSTRUCTOR, TypedArray);\n\n    if (CLAMPED ? new TypedArray(1)[TAG] != NAME : !(TAG in TypedArrayPrototype)) {\n      dP(TypedArrayPrototype, TAG, {\n        get: function () { return NAME; }\n      });\n    }\n\n    O[NAME] = TypedArray;\n\n    $export($export.G + $export.W + $export.F * (TypedArray != Base), O);\n\n    $export($export.S, NAME, {\n      BYTES_PER_ELEMENT: BYTES\n    });\n\n    $export($export.S + $export.F * fails(function () { Base.of.call(TypedArray, 1); }), NAME, {\n      from: $from,\n      of: $of\n    });\n\n    if (!(BYTES_PER_ELEMENT in TypedArrayPrototype)) hide(TypedArrayPrototype, BYTES_PER_ELEMENT, BYTES);\n\n    $export($export.P, NAME, proto);\n\n    setSpecies(NAME);\n\n    $export($export.P + $export.F * FORCED_SET, NAME, { set: $set });\n\n    $export($export.P + $export.F * !CORRECT_ITER_NAME, NAME, $iterators);\n\n    if (!LIBRARY && TypedArrayPrototype.toString != arrayToString) TypedArrayPrototype.toString = arrayToString;\n\n    $export($export.P + $export.F * fails(function () {\n      new TypedArray(1).slice();\n    }), NAME, { slice: $slice });\n\n    $export($export.P + $export.F * (fails(function () {\n      return [1, 2].toLocaleString() != new TypedArray([1, 2]).toLocaleString();\n    }) || !fails(function () {\n      TypedArrayPrototype.toLocaleString.call([1, 2]);\n    })), NAME, { toLocaleString: $toLocaleString });\n\n    Iterators[NAME] = CORRECT_ITER_NAME ? $nativeIterator : $iterator;\n    if (!LIBRARY && !CORRECT_ITER_NAME) hide(TypedArrayPrototype, ITERATOR, $iterator);\n  };\n} else module.exports = function () { /* empty */ };\n","'use strict';\nvar global = require('./_global');\nvar DESCRIPTORS = require('./_descriptors');\nvar LIBRARY = require('./_library');\nvar $typed = require('./_typed');\nvar hide = require('./_hide');\nvar redefineAll = require('./_redefine-all');\nvar fails = require('./_fails');\nvar anInstance = require('./_an-instance');\nvar toInteger = require('./_to-integer');\nvar toLength = require('./_to-length');\nvar toIndex = require('./_to-index');\nvar gOPN = require('./_object-gopn').f;\nvar dP = require('./_object-dp').f;\nvar arrayFill = require('./_array-fill');\nvar setToStringTag = require('./_set-to-string-tag');\nvar ARRAY_BUFFER = 'ArrayBuffer';\nvar DATA_VIEW = 'DataView';\nvar PROTOTYPE = 'prototype';\nvar WRONG_LENGTH = 'Wrong length!';\nvar WRONG_INDEX = 'Wrong index!';\nvar $ArrayBuffer = global[ARRAY_BUFFER];\nvar $DataView = global[DATA_VIEW];\nvar Math = global.Math;\nvar RangeError = global.RangeError;\n// eslint-disable-next-line no-shadow-restricted-names\nvar Infinity = global.Infinity;\nvar BaseBuffer = $ArrayBuffer;\nvar abs = Math.abs;\nvar pow = Math.pow;\nvar floor = Math.floor;\nvar log = Math.log;\nvar LN2 = Math.LN2;\nvar BUFFER = 'buffer';\nvar BYTE_LENGTH = 'byteLength';\nvar BYTE_OFFSET = 'byteOffset';\nvar $BUFFER = DESCRIPTORS ? '_b' : BUFFER;\nvar $LENGTH = DESCRIPTORS ? '_l' : BYTE_LENGTH;\nvar $OFFSET = DESCRIPTORS ? '_o' : BYTE_OFFSET;\n\n// IEEE754 conversions based on https://github.com/feross/ieee754\nfunction packIEEE754(value, mLen, nBytes) {\n  var buffer = new Array(nBytes);\n  var eLen = nBytes * 8 - mLen - 1;\n  var eMax = (1 << eLen) - 1;\n  var eBias = eMax >> 1;\n  var rt = mLen === 23 ? pow(2, -24) - pow(2, -77) : 0;\n  var i = 0;\n  var s = value < 0 || value === 0 && 1 / value < 0 ? 1 : 0;\n  var e, m, c;\n  value = abs(value);\n  // eslint-disable-next-line no-self-compare\n  if (value != value || value === Infinity) {\n    // eslint-disable-next-line no-self-compare\n    m = value != value ? 1 : 0;\n    e = eMax;\n  } else {\n    e = floor(log(value) / LN2);\n    if (value * (c = pow(2, -e)) < 1) {\n      e--;\n      c *= 2;\n    }\n    if (e + eBias >= 1) {\n      value += rt / c;\n    } else {\n      value += rt * pow(2, 1 - eBias);\n    }\n    if (value * c >= 2) {\n      e++;\n      c /= 2;\n    }\n    if (e + eBias >= eMax) {\n      m = 0;\n      e = eMax;\n    } else if (e + eBias >= 1) {\n      m = (value * c - 1) * pow(2, mLen);\n      e = e + eBias;\n    } else {\n      m = value * pow(2, eBias - 1) * pow(2, mLen);\n      e = 0;\n    }\n  }\n  for (; mLen >= 8; buffer[i++] = m & 255, m /= 256, mLen -= 8);\n  e = e << mLen | m;\n  eLen += mLen;\n  for (; eLen > 0; buffer[i++] = e & 255, e /= 256, eLen -= 8);\n  buffer[--i] |= s * 128;\n  return buffer;\n}\nfunction unpackIEEE754(buffer, mLen, nBytes) {\n  var eLen = nBytes * 8 - mLen - 1;\n  var eMax = (1 << eLen) - 1;\n  var eBias = eMax >> 1;\n  var nBits = eLen - 7;\n  var i = nBytes - 1;\n  var s = buffer[i--];\n  var e = s & 127;\n  var m;\n  s >>= 7;\n  for (; nBits > 0; e = e * 256 + buffer[i], i--, nBits -= 8);\n  m = e & (1 << -nBits) - 1;\n  e >>= -nBits;\n  nBits += mLen;\n  for (; nBits > 0; m = m * 256 + buffer[i], i--, nBits -= 8);\n  if (e === 0) {\n    e = 1 - eBias;\n  } else if (e === eMax) {\n    return m ? NaN : s ? -Infinity : Infinity;\n  } else {\n    m = m + pow(2, mLen);\n    e = e - eBias;\n  } return (s ? -1 : 1) * m * pow(2, e - mLen);\n}\n\nfunction unpackI32(bytes) {\n  return bytes[3] << 24 | bytes[2] << 16 | bytes[1] << 8 | bytes[0];\n}\nfunction packI8(it) {\n  return [it & 0xff];\n}\nfunction packI16(it) {\n  return [it & 0xff, it >> 8 & 0xff];\n}\nfunction packI32(it) {\n  return [it & 0xff, it >> 8 & 0xff, it >> 16 & 0xff, it >> 24 & 0xff];\n}\nfunction packF64(it) {\n  return packIEEE754(it, 52, 8);\n}\nfunction packF32(it) {\n  return packIEEE754(it, 23, 4);\n}\n\nfunction addGetter(C, key, internal) {\n  dP(C[PROTOTYPE], key, { get: function () { return this[internal]; } });\n}\n\nfunction get(view, bytes, index, isLittleEndian) {\n  var numIndex = +index;\n  var intIndex = toIndex(numIndex);\n  if (intIndex + bytes > view[$LENGTH]) throw RangeError(WRONG_INDEX);\n  var store = view[$BUFFER]._b;\n  var start = intIndex + view[$OFFSET];\n  var pack = store.slice(start, start + bytes);\n  return isLittleEndian ? pack : pack.reverse();\n}\nfunction set(view, bytes, index, conversion, value, isLittleEndian) {\n  var numIndex = +index;\n  var intIndex = toIndex(numIndex);\n  if (intIndex + bytes > view[$LENGTH]) throw RangeError(WRONG_INDEX);\n  var store = view[$BUFFER]._b;\n  var start = intIndex + view[$OFFSET];\n  var pack = conversion(+value);\n  for (var i = 0; i < bytes; i++) store[start + i] = pack[isLittleEndian ? i : bytes - i - 1];\n}\n\nif (!$typed.ABV) {\n  $ArrayBuffer = function ArrayBuffer(length) {\n    anInstance(this, $ArrayBuffer, ARRAY_BUFFER);\n    var byteLength = toIndex(length);\n    this._b = arrayFill.call(new Array(byteLength), 0);\n    this[$LENGTH] = byteLength;\n  };\n\n  $DataView = function DataView(buffer, byteOffset, byteLength) {\n    anInstance(this, $DataView, DATA_VIEW);\n    anInstance(buffer, $ArrayBuffer, DATA_VIEW);\n    var bufferLength = buffer[$LENGTH];\n    var offset = toInteger(byteOffset);\n    if (offset < 0 || offset > bufferLength) throw RangeError('Wrong offset!');\n    byteLength = byteLength === undefined ? bufferLength - offset : toLength(byteLength);\n    if (offset + byteLength > bufferLength) throw RangeError(WRONG_LENGTH);\n    this[$BUFFER] = buffer;\n    this[$OFFSET] = offset;\n    this[$LENGTH] = byteLength;\n  };\n\n  if (DESCRIPTORS) {\n    addGetter($ArrayBuffer, BYTE_LENGTH, '_l');\n    addGetter($DataView, BUFFER, '_b');\n    addGetter($DataView, BYTE_LENGTH, '_l');\n    addGetter($DataView, BYTE_OFFSET, '_o');\n  }\n\n  redefineAll($DataView[PROTOTYPE], {\n    getInt8: function getInt8(byteOffset) {\n      return get(this, 1, byteOffset)[0] << 24 >> 24;\n    },\n    getUint8: function getUint8(byteOffset) {\n      return get(this, 1, byteOffset)[0];\n    },\n    getInt16: function getInt16(byteOffset /* , littleEndian */) {\n      var bytes = get(this, 2, byteOffset, arguments[1]);\n      return (bytes[1] << 8 | bytes[0]) << 16 >> 16;\n    },\n    getUint16: function getUint16(byteOffset /* , littleEndian */) {\n      var bytes = get(this, 2, byteOffset, arguments[1]);\n      return bytes[1] << 8 | bytes[0];\n    },\n    getInt32: function getInt32(byteOffset /* , littleEndian */) {\n      return unpackI32(get(this, 4, byteOffset, arguments[1]));\n    },\n    getUint32: function getUint32(byteOffset /* , littleEndian */) {\n      return unpackI32(get(this, 4, byteOffset, arguments[1])) >>> 0;\n    },\n    getFloat32: function getFloat32(byteOffset /* , littleEndian */) {\n      return unpackIEEE754(get(this, 4, byteOffset, arguments[1]), 23, 4);\n    },\n    getFloat64: function getFloat64(byteOffset /* , littleEndian */) {\n      return unpackIEEE754(get(this, 8, byteOffset, arguments[1]), 52, 8);\n    },\n    setInt8: function setInt8(byteOffset, value) {\n      set(this, 1, byteOffset, packI8, value);\n    },\n    setUint8: function setUint8(byteOffset, value) {\n      set(this, 1, byteOffset, packI8, value);\n    },\n    setInt16: function setInt16(byteOffset, value /* , littleEndian */) {\n      set(this, 2, byteOffset, packI16, value, arguments[2]);\n    },\n    setUint16: function setUint16(byteOffset, value /* , littleEndian */) {\n      set(this, 2, byteOffset, packI16, value, arguments[2]);\n    },\n    setInt32: function setInt32(byteOffset, value /* , littleEndian */) {\n      set(this, 4, byteOffset, packI32, value, arguments[2]);\n    },\n    setUint32: function setUint32(byteOffset, value /* , littleEndian */) {\n      set(this, 4, byteOffset, packI32, value, arguments[2]);\n    },\n    setFloat32: function setFloat32(byteOffset, value /* , littleEndian */) {\n      set(this, 4, byteOffset, packF32, value, arguments[2]);\n    },\n    setFloat64: function setFloat64(byteOffset, value /* , littleEndian */) {\n      set(this, 8, byteOffset, packF64, value, arguments[2]);\n    }\n  });\n} else {\n  if (!fails(function () {\n    $ArrayBuffer(1);\n  }) || !fails(function () {\n    new $ArrayBuffer(-1); // eslint-disable-line no-new\n  }) || fails(function () {\n    new $ArrayBuffer(); // eslint-disable-line no-new\n    new $ArrayBuffer(1.5); // eslint-disable-line no-new\n    new $ArrayBuffer(NaN); // eslint-disable-line no-new\n    return $ArrayBuffer.name != ARRAY_BUFFER;\n  })) {\n    $ArrayBuffer = function ArrayBuffer(length) {\n      anInstance(this, $ArrayBuffer);\n      return new BaseBuffer(toIndex(length));\n    };\n    var ArrayBufferProto = $ArrayBuffer[PROTOTYPE] = BaseBuffer[PROTOTYPE];\n    for (var keys = gOPN(BaseBuffer), j = 0, key; keys.length > j;) {\n      if (!((key = keys[j++]) in $ArrayBuffer)) hide($ArrayBuffer, key, BaseBuffer[key]);\n    }\n    if (!LIBRARY) ArrayBufferProto.constructor = $ArrayBuffer;\n  }\n  // iOS Safari 7.x bug\n  var view = new $DataView(new $ArrayBuffer(2));\n  var $setInt8 = $DataView[PROTOTYPE].setInt8;\n  view.setInt8(0, 2147483648);\n  view.setInt8(1, 2147483649);\n  if (view.getInt8(0) || !view.getInt8(1)) redefineAll($DataView[PROTOTYPE], {\n    setInt8: function setInt8(byteOffset, value) {\n      $setInt8.call(this, byteOffset, value << 24 >> 24);\n    },\n    setUint8: function setUint8(byteOffset, value) {\n      $setInt8.call(this, byteOffset, value << 24 >> 24);\n    }\n  }, true);\n}\nsetToStringTag($ArrayBuffer, ARRAY_BUFFER);\nsetToStringTag($DataView, DATA_VIEW);\nhide($DataView[PROTOTYPE], $typed.VIEW, true);\nexports[ARRAY_BUFFER] = $ArrayBuffer;\nexports[DATA_VIEW] = $DataView;\n","// 21.1.3.18 String.prototype.startsWith(searchString [, position ])\n'use strict';\nvar $export = require('./_export');\nvar toLength = require('./_to-length');\nvar context = require('./_string-context');\nvar STARTS_WITH = 'startsWith';\nvar $startsWith = ''[STARTS_WITH];\n\n$export($export.P + $export.F * require('./_fails-is-regexp')(STARTS_WITH), 'String', {\n  startsWith: function startsWith(searchString /* , position = 0 */) {\n    var that = context(this, searchString, STARTS_WITH);\n    var index = toLength(Math.min(arguments.length > 1 ? arguments[1] : undefined, that.length));\n    var search = String(searchString);\n    return $startsWith\n      ? $startsWith.call(that, search, index)\n      : that.slice(index, index + search.length) === search;\n  }\n});\n","// https://tc39.github.io/ecma262/#sec-toindex\nvar toInteger = require('./_to-integer');\nvar toLength = require('./_to-length');\nmodule.exports = function (it) {\n  if (it === undefined) return 0;\n  var number = toInteger(it);\n  var length = toLength(number);\n  if (number !== length) throw RangeError('Wrong length!');\n  return length;\n};\n","var global = require('./_global');\nvar hide = require('./_hide');\nvar uid = require('./_uid');\nvar TYPED = uid('typed_array');\nvar VIEW = uid('view');\nvar ABV = !!(global.ArrayBuffer && global.DataView);\nvar CONSTR = ABV;\nvar i = 0;\nvar l = 9;\nvar Typed;\n\nvar TypedArrayConstructors = (\n  'Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array'\n).split(',');\n\nwhile (i < l) {\n  if (Typed = global[TypedArrayConstructors[i++]]) {\n    hide(Typed.prototype, TYPED, true);\n    hide(Typed.prototype, VIEW, true);\n  } else CONSTR = false;\n}\n\nmodule.exports = {\n  ABV: ABV,\n  CONSTR: CONSTR,\n  TYPED: TYPED,\n  VIEW: VIEW\n};\n","var $export = require('./_export');\n\n$export($export.P, 'String', {\n  // 21.1.3.13 String.prototype.repeat(count)\n  repeat: require('./_string-repeat')\n});\n","var $export = require('./_export');\n$export($export.G + $export.W + $export.F * !require('./_typed').ABV, {\n  DataView: require('./_typed-buffer').DataView\n});\n","require('./_typed-array')('Uint8', 1, function (init) {\n  return function Uint8Array(data, byteOffset, length) {\n    return init(this, data, byteOffset, length);\n  };\n});\n","// 22.1.3.6 Array.prototype.fill(value, start = 0, end = this.length)\n'use strict';\nvar toObject = require('./_to-object');\nvar toAbsoluteIndex = require('./_to-absolute-index');\nvar toLength = require('./_to-length');\nmodule.exports = function fill(value /* , start = 0, end = @length */) {\n  var O = toObject(this);\n  var length = toLength(O.length);\n  var aLen = arguments.length;\n  var index = toAbsoluteIndex(aLen > 1 ? arguments[1] : undefined, length);\n  var end = aLen > 2 ? arguments[2] : undefined;\n  var endPos = end === undefined ? length : toAbsoluteIndex(end, length);\n  while (endPos > index) O[index++] = value;\n  return O;\n};\n","var $export = require('./_export');\nvar fails = require('./_fails');\nvar defined = require('./_defined');\nvar quot = /\"/g;\n// B.2.3.2.1 CreateHTML(string, tag, attribute, value)\nvar createHTML = function (string, tag, attribute, value) {\n  var S = String(defined(string));\n  var p1 = '<' + tag;\n  if (attribute !== '') p1 += ' ' + attribute + '=\"' + String(value).replace(quot, '&quot;') + '\"';\n  return p1 + '>' + S + '</' + tag + '>';\n};\nmodule.exports = function (NAME, exec) {\n  var O = {};\n  O[NAME] = exec(createHTML);\n  $export($export.P + $export.F * fails(function () {\n    var test = ''[NAME]('\"');\n    return test !== test.toLowerCase() || test.split('\"').length > 3;\n  }), 'String', O);\n};\n","import \"core-js/modules/es6.array.map\";\nimport \"core-js/modules/es6.string.starts-with\";\nimport \"core-js/modules/es6.array.some\";\nimport \"core-js/modules/es6.string.link\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.array.iterator\";\nimport \"core-js/modules/es6.string.iterator\";\nimport \"core-js/modules/es6.date.now\";\nimport \"core-js/modules/es6.promise\";\nimport \"core-js/modules/es6.object.to-string\";\nimport \"core-js/modules/es6.string.repeat\";\nimport \"core-js/modules/es6.regexp.replace\";\nimport \"core-js/modules/es6.typed.data-view\";\nimport \"core-js/modules/es6.typed.uint8-array\";\nimport firebase from '@firebase/app';\nimport { __spread, __awaiter, __generator, __extends, __assign } from 'tslib';\nimport { ErrorFactory, createSubscribe } from '@firebase/util';\nimport '@firebase/installations';\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\nvar _a;\n\nvar ERROR_MAP = (_a = {}, _a[\"only-available-in-window\"\n/* AVAILABLE_IN_WINDOW */\n] = 'This method is available in a Window context.', _a[\"only-available-in-sw\"\n/* AVAILABLE_IN_SW */\n] = 'This method is available in a service worker context.', _a[\"should-be-overriden\"\n/* SHOULD_BE_INHERITED */\n] = 'This method should be overriden by extended classes.', _a[\"bad-sender-id\"\n/* BAD_SENDER_ID */\n] = \"Please ensure that 'messagingSenderId' is set \" + 'correctly in the options passed into firebase.initializeApp().', _a[\"permission-default\"\n/* PERMISSION_DEFAULT */\n] = 'The required permissions were not granted and dismissed instead.', _a[\"permission-blocked\"\n/* PERMISSION_BLOCKED */\n] = 'The required permissions were not granted and blocked instead.', _a[\"unsupported-browser\"\n/* UNSUPPORTED_BROWSER */\n] = \"This browser doesn't support the API's \" + 'required to use the firebase SDK.', _a[\"notifications-blocked\"\n/* NOTIFICATIONS_BLOCKED */\n] = 'Notifications have been blocked.', _a[\"failed-serviceworker-registration\"\n/* FAILED_DEFAULT_REGISTRATION */\n] = 'We are unable to register the ' + 'default service worker. {$browserErrorMessage}', _a[\"sw-registration-expected\"\n/* SW_REGISTRATION_EXPECTED */\n] = 'A service worker registration was the expected input.', _a[\"get-subscription-failed\"\n/* GET_SUBSCRIPTION_FAILED */\n] = 'There was an error when trying to get ' + 'any existing Push Subscriptions.', _a[\"invalid-saved-token\"\n/* INVALID_SAVED_TOKEN */\n] = 'Unable to access details of the saved token.', _a[\"sw-reg-redundant\"\n/* SW_REG_REDUNDANT */\n] = 'The service worker being used for push was made redundant.', _a[\"token-subscribe-failed\"\n/* TOKEN_SUBSCRIBE_FAILED */\n] = 'A problem occured while subscribing the user to FCM: {$errorInfo}', _a[\"token-subscribe-no-token\"\n/* TOKEN_SUBSCRIBE_NO_TOKEN */\n] = 'FCM returned no token when subscribing the user to push.', _a[\"token-unsubscribe-failed\"\n/* TOKEN_UNSUBSCRIBE_FAILED */\n] = 'A problem occured while unsubscribing the ' + 'user from FCM: {$errorInfo}', _a[\"token-update-failed\"\n/* TOKEN_UPDATE_FAILED */\n] = 'A problem occured while updating the user from FCM: {$errorInfo}', _a[\"token-update-no-token\"\n/* TOKEN_UPDATE_NO_TOKEN */\n] = 'FCM returned no token when updating the user to push.', _a[\"use-sw-before-get-token\"\n/* USE_SW_BEFORE_GET_TOKEN */\n] = 'The useServiceWorker() method may only be called once and must be ' + 'called before calling getToken() to ensure your service worker is used.', _a[\"invalid-delete-token\"\n/* INVALID_DELETE_TOKEN */\n] = 'You must pass a valid token into ' + 'deleteToken(), i.e. the token from getToken().', _a[\"delete-token-not-found\"\n/* DELETE_TOKEN_NOT_FOUND */\n] = 'The deletion attempt for token could not ' + 'be performed as the token was not found.', _a[\"delete-scope-not-found\"\n/* DELETE_SCOPE_NOT_FOUND */\n] = 'The deletion attempt for service worker ' + 'scope could not be performed as the scope was not found.', _a[\"bg-handler-function-expected\"\n/* BG_HANDLER_FUNCTION_EXPECTED */\n] = 'The input to setBackgroundMessageHandler() must be a function.', _a[\"no-window-client-to-msg\"\n/* NO_WINDOW_CLIENT_TO_MSG */\n] = 'An attempt was made to message a non-existant window client.', _a[\"unable-to-resubscribe\"\n/* UNABLE_TO_RESUBSCRIBE */\n] = 'There was an error while re-subscribing ' + 'the FCM token for push messaging. Will have to resubscribe the ' + 'user on next visit. {$errorInfo}', _a[\"no-fcm-token-for-resubscribe\"\n/* NO_FCM_TOKEN_FOR_RESUBSCRIBE */\n] = 'Could not find an FCM token ' + 'and as a result, unable to resubscribe. Will have to resubscribe the ' + 'user on next visit.', _a[\"failed-to-delete-token\"\n/* FAILED_TO_DELETE_TOKEN */\n] = 'Unable to delete the currently saved token.', _a[\"no-sw-in-reg\"\n/* NO_SW_IN_REG */\n] = 'Even though the service worker registration was ' + 'successful, there was a problem accessing the service worker itself.', _a[\"bad-scope\"\n/* BAD_SCOPE */\n] = 'The service worker scope must be a string with at ' + 'least one character.', _a[\"bad-vapid-key\"\n/* BAD_VAPID_KEY */\n] = 'The public VAPID key is not a Uint8Array with 65 bytes.', _a[\"bad-subscription\"\n/* BAD_SUBSCRIPTION */\n] = 'The subscription must be a valid PushSubscription.', _a[\"bad-token\"\n/* BAD_TOKEN */\n] = 'The FCM Token used for storage / lookup was not ' + 'a valid token string.', _a[\"failed-delete-vapid-key\"\n/* FAILED_DELETE_VAPID_KEY */\n] = 'The VAPID key could not be deleted.', _a[\"invalid-public-vapid-key\"\n/* INVALID_PUBLIC_VAPID_KEY */\n] = 'The public VAPID key must be a string.', _a[\"use-public-key-before-get-token\"\n/* USE_PUBLIC_KEY_BEFORE_GET_TOKEN */\n] = 'The usePublicVapidKey() method may only be called once and must be ' + 'called before calling getToken() to ensure your VAPID key is used.', _a[\"public-vapid-key-decryption-failed\"\n/* PUBLIC_KEY_DECRYPTION_FAILED */\n] = 'The public VAPID key did not equal 65 bytes when decrypted.', _a);\nvar errorFactory = new ErrorFactory('messaging', 'Messaging', ERROR_MAP);\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\nvar DEFAULT_PUBLIC_VAPID_KEY = new Uint8Array([0x04, 0x33, 0x94, 0xf7, 0xdf, 0xa1, 0xeb, 0xb1, 0xdc, 0x03, 0xa2, 0x5e, 0x15, 0x71, 0xdb, 0x48, 0xd3, 0x2e, 0xed, 0xed, 0xb2, 0x34, 0xdb, 0xb7, 0x47, 0x3a, 0x0c, 0x8f, 0xc4, 0xcc, 0xe1, 0x6f, 0x3c, 0x8c, 0x84, 0xdf, 0xab, 0xb6, 0x66, 0x3e, 0xf2, 0x0c, 0xd4, 0x8b, 0xfe, 0xe3, 0xf9, 0x76, 0x2f, 0x14, 0x1c, 0x63, 0x08, 0x6a, 0x6f, 0x2d, 0xb1, 0x1a, 0x95, 0xb0, 0xce, 0x37, 0xc0, 0x9c, 0x6e]);\nvar ENDPOINT = 'https://fcmregistrations.googleapis.com/v1';\nvar FN_CAMPAIGN_ID = 'google.c.a.c_id';\nvar FN_CAMPAIGN_NAME = 'google.c.a.c_l';\nvar FN_CAMPAIGN_TIME = 'google.c.a.ts';\n/** Set to '1' if Analytics is enabled for the campaign */\n\nvar FN_CAMPAIGN_ANALYTICS_ENABLED = 'google.c.a.e';\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\nvar MessageType;\n\n(function (MessageType) {\n  MessageType[\"PUSH_MSG_RECEIVED\"] = \"push-msg-received\";\n  MessageType[\"NOTIFICATION_CLICKED\"] = \"notification-clicked\";\n})(MessageType || (MessageType = {}));\n/**\r\n * @license\r\n * Copyright 2018 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction isArrayBufferEqual(a, b) {\n  if (a == null || b == null) {\n    return false;\n  }\n\n  if (a === b) {\n    return true;\n  }\n\n  if (a.byteLength !== b.byteLength) {\n    return false;\n  }\n\n  var viewA = new DataView(a);\n  var viewB = new DataView(b);\n\n  for (var i = 0; i < a.byteLength; i++) {\n    if (viewA.getUint8(i) !== viewB.getUint8(i)) {\n      return false;\n    }\n  }\n\n  return true;\n}\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction toBase64(arrayBuffer) {\n  var uint8Version = new Uint8Array(arrayBuffer);\n  return btoa(String.fromCharCode.apply(String, __spread(uint8Version)));\n}\n\nfunction arrayBufferToBase64(arrayBuffer) {\n  var base64String = toBase64(arrayBuffer);\n  return base64String.replace(/=/g, '').replace(/\\+/g, '-').replace(/\\//g, '_');\n}\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nvar SubscriptionManager =\n/** @class */\nfunction () {\n  function SubscriptionManager() {}\n\n  SubscriptionManager.prototype.getToken = function (app, subscription, vapidKey) {\n    return __awaiter(this, void 0, void 0, function () {\n      var headers, body, subscribeOptions, responseData, response, err_1, message;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , getHeaders(app)];\n\n          case 1:\n            headers = _a.sent();\n            body = getBody(subscription, vapidKey);\n            subscribeOptions = {\n              method: 'POST',\n              headers: headers,\n              body: JSON.stringify(body)\n            };\n            _a.label = 2;\n\n          case 2:\n            _a.trys.push([2, 5,, 6]);\n\n            return [4\n            /*yield*/\n            , fetch(getEndpoint(app), subscribeOptions)];\n\n          case 3:\n            response = _a.sent();\n            return [4\n            /*yield*/\n            , response.json()];\n\n          case 4:\n            responseData = _a.sent();\n            return [3\n            /*break*/\n            , 6];\n\n          case 5:\n            err_1 = _a.sent();\n            throw errorFactory.create(\"token-subscribe-failed\"\n            /* TOKEN_SUBSCRIBE_FAILED */\n            , {\n              errorInfo: err_1\n            });\n\n          case 6:\n            if (responseData.error) {\n              message = responseData.error.message;\n              throw errorFactory.create(\"token-subscribe-failed\"\n              /* TOKEN_SUBSCRIBE_FAILED */\n              , {\n                errorInfo: message\n              });\n            }\n\n            if (!responseData.token) {\n              throw errorFactory.create(\"token-subscribe-no-token\"\n              /* TOKEN_SUBSCRIBE_NO_TOKEN */\n              );\n            }\n\n            return [2\n            /*return*/\n            , responseData.token];\n        }\n      });\n    });\n  };\n  /**\r\n   * Update the underlying token details for fcmToken.\r\n   */\n\n\n  SubscriptionManager.prototype.updateToken = function (tokenDetails, app, subscription, vapidKey) {\n    return __awaiter(this, void 0, void 0, function () {\n      var headers, body, updateOptions, responseData, response, err_2, message;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , getHeaders(app)];\n\n          case 1:\n            headers = _a.sent();\n            body = getBody(subscription, vapidKey);\n            updateOptions = {\n              method: 'PATCH',\n              headers: headers,\n              body: JSON.stringify(body)\n            };\n            _a.label = 2;\n\n          case 2:\n            _a.trys.push([2, 5,, 6]);\n\n            return [4\n            /*yield*/\n            , fetch(getEndpoint(app) + \"/\" + tokenDetails.fcmToken, updateOptions)];\n\n          case 3:\n            response = _a.sent();\n            return [4\n            /*yield*/\n            , response.json()];\n\n          case 4:\n            responseData = _a.sent();\n            return [3\n            /*break*/\n            , 6];\n\n          case 5:\n            err_2 = _a.sent();\n            throw errorFactory.create(\"token-update-failed\"\n            /* TOKEN_UPDATE_FAILED */\n            , {\n              errorInfo: err_2\n            });\n\n          case 6:\n            if (responseData.error) {\n              message = responseData.error.message;\n              throw errorFactory.create(\"token-update-failed\"\n              /* TOKEN_UPDATE_FAILED */\n              , {\n                errorInfo: message\n              });\n            }\n\n            if (!responseData.token) {\n              throw errorFactory.create(\"token-update-no-token\"\n              /* TOKEN_UPDATE_NO_TOKEN */\n              );\n            }\n\n            return [2\n            /*return*/\n            , responseData.token];\n        }\n      });\n    });\n  };\n\n  SubscriptionManager.prototype.deleteToken = function (app, tokenDetails) {\n    return __awaiter(this, void 0, void 0, function () {\n      var headers, unsubscribeOptions, response, responseData, message, err_3;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , getHeaders(app)];\n\n          case 1:\n            headers = _a.sent();\n            unsubscribeOptions = {\n              method: 'DELETE',\n              headers: headers\n            };\n            _a.label = 2;\n\n          case 2:\n            _a.trys.push([2, 5,, 6]);\n\n            return [4\n            /*yield*/\n            , fetch(getEndpoint(app) + \"/\" + tokenDetails.fcmToken, unsubscribeOptions)];\n\n          case 3:\n            response = _a.sent();\n            return [4\n            /*yield*/\n            , response.json()];\n\n          case 4:\n            responseData = _a.sent();\n\n            if (responseData.error) {\n              message = responseData.error.message;\n              throw errorFactory.create(\"token-unsubscribe-failed\"\n              /* TOKEN_UNSUBSCRIBE_FAILED */\n              , {\n                errorInfo: message\n              });\n            }\n\n            return [3\n            /*break*/\n            , 6];\n\n          case 5:\n            err_3 = _a.sent();\n            throw errorFactory.create(\"token-unsubscribe-failed\"\n            /* TOKEN_UNSUBSCRIBE_FAILED */\n            , {\n              errorInfo: err_3\n            });\n\n          case 6:\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  return SubscriptionManager;\n}();\n\nfunction getEndpoint(app) {\n  return ENDPOINT + \"/projects/\" + app.options.projectId + \"/registrations\";\n}\n\nfunction getHeaders(app) {\n  return __awaiter(this, void 0, void 0, function () {\n    var installations, authToken;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          installations = app.installations();\n          return [4\n          /*yield*/\n          , installations.getToken()];\n\n        case 1:\n          authToken = _a.sent();\n          return [2\n          /*return*/\n          , new Headers({\n            'Content-Type': 'application/json',\n            Accept: 'application/json',\n            'x-goog-api-key': app.options.apiKey,\n            'x-goog-firebase-installations-auth': \"FIS \" + authToken\n          })];\n      }\n    });\n  });\n}\n\nfunction getBody(subscription, vapidKey) {\n  var p256dh = arrayBufferToBase64(subscription.getKey('p256dh'));\n  var auth = arrayBufferToBase64(subscription.getKey('auth'));\n  var body = {\n    web: {\n      endpoint: subscription.endpoint,\n      p256dh: p256dh,\n      auth: auth\n    }\n  };\n\n  if (!isArrayBufferEqual(vapidKey.buffer, DEFAULT_PUBLIC_VAPID_KEY.buffer)) {\n    body.web.applicationPubKey = arrayBufferToBase64(vapidKey);\n  }\n\n  return body;\n}\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction base64ToArrayBuffer(base64String) {\n  var padding = '='.repeat((4 - base64String.length % 4) % 4);\n  var base64 = (base64String + padding).replace(/\\-/g, '+').replace(/_/g, '/');\n  var rawData = atob(base64);\n  var outputArray = new Uint8Array(rawData.length);\n\n  for (var i = 0; i < rawData.length; ++i) {\n    outputArray[i] = rawData.charCodeAt(i);\n  }\n\n  return outputArray;\n}\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nvar OLD_DB_NAME = 'undefined';\nvar OLD_OBJECT_STORE_NAME = 'fcm_token_object_Store';\n\nfunction handleDb(db, app) {\n  if (!db.objectStoreNames.contains(OLD_OBJECT_STORE_NAME)) {\n    // We found a database with the name 'undefined', but our expected object\n    // store isn't defined.\n    return;\n  }\n\n  var transaction = db.transaction(OLD_OBJECT_STORE_NAME);\n  var objectStore = transaction.objectStore(OLD_OBJECT_STORE_NAME);\n  var subscriptionManager = new SubscriptionManager();\n  var openCursorRequest = objectStore.openCursor();\n\n  openCursorRequest.onerror = function (event) {\n    // NOOP - Nothing we can do.\n    console.warn('Unable to cleanup old IDB.', event);\n  };\n\n  openCursorRequest.onsuccess = function () {\n    var cursor = openCursorRequest.result;\n\n    if (cursor) {\n      // cursor.value contains the current record being iterated through\n      // this is where you'd do something with the result\n      var tokenDetails = cursor.value; // eslint-disable-next-line @typescript-eslint/no-floating-promises\n\n      subscriptionManager.deleteToken(app, tokenDetails);\n      cursor[\"continue\"]();\n    } else {\n      db.close();\n      indexedDB.deleteDatabase(OLD_DB_NAME);\n    }\n  };\n}\n\nfunction cleanV1(app) {\n  var request = indexedDB.open(OLD_DB_NAME);\n\n  request.onerror = function (_event) {// NOOP - Nothing we can do.\n  };\n\n  request.onsuccess = function (_event) {\n    var db = request.result;\n    handleDb(db, app);\n  };\n}\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nvar DbInterface =\n/** @class */\nfunction () {\n  function DbInterface() {\n    this.dbPromise = null;\n  }\n  /** Gets record(s) from the objectStore that match the given key. */\n\n\n  DbInterface.prototype.get = function (key) {\n    return this.createTransaction(function (objectStore) {\n      return objectStore.get(key);\n    });\n  };\n  /** Gets record(s) from the objectStore that match the given index. */\n\n\n  DbInterface.prototype.getIndex = function (index, key) {\n    function runRequest(objectStore) {\n      var idbIndex = objectStore.index(index);\n      return idbIndex.get(key);\n    }\n\n    return this.createTransaction(runRequest);\n  };\n  /** Assigns or overwrites the record for the given value. */\n  // IndexedDB values are of type \"any\"\n\n\n  DbInterface.prototype.put = function (value) {\n    return this.createTransaction(function (objectStore) {\n      return objectStore.put(value);\n    }, 'readwrite');\n  };\n  /** Deletes record(s) from the objectStore that match the given key. */\n\n\n  DbInterface.prototype[\"delete\"] = function (key) {\n    return this.createTransaction(function (objectStore) {\n      return objectStore[\"delete\"](key);\n    }, 'readwrite');\n  };\n  /**\r\n   * Close the currently open database.\r\n   */\n\n\n  DbInterface.prototype.closeDatabase = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var db;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            if (!this.dbPromise) return [3\n            /*break*/\n            , 2];\n            return [4\n            /*yield*/\n            , this.dbPromise];\n\n          case 1:\n            db = _a.sent();\n            db.close();\n            this.dbPromise = null;\n            _a.label = 2;\n\n          case 2:\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n  /**\r\n   * Creates an IndexedDB Transaction and passes its objectStore to the\r\n   * runRequest function, which runs the database request.\r\n   *\r\n   * @return Promise that resolves with the result of the runRequest function\r\n   */\n\n\n  DbInterface.prototype.createTransaction = function (runRequest, mode) {\n    if (mode === void 0) {\n      mode = 'readonly';\n    }\n\n    return __awaiter(this, void 0, void 0, function () {\n      var db, transaction, request, result;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , this.getDb()];\n\n          case 1:\n            db = _a.sent();\n            transaction = db.transaction(this.objectStoreName, mode);\n            request = transaction.objectStore(this.objectStoreName);\n            return [4\n            /*yield*/\n            , promisify(runRequest(request))];\n\n          case 2:\n            result = _a.sent();\n            return [2\n            /*return*/\n            , new Promise(function (resolve, reject) {\n              transaction.oncomplete = function () {\n                resolve(result);\n              };\n\n              transaction.onerror = function () {\n                reject(transaction.error);\n              };\n            })];\n        }\n      });\n    });\n  };\n  /** Gets the cached db connection or opens a new one. */\n\n\n  DbInterface.prototype.getDb = function () {\n    var _this = this;\n\n    if (!this.dbPromise) {\n      this.dbPromise = new Promise(function (resolve, reject) {\n        var request = indexedDB.open(_this.dbName, _this.dbVersion);\n\n        request.onsuccess = function () {\n          resolve(request.result);\n        };\n\n        request.onerror = function () {\n          _this.dbPromise = null;\n          reject(request.error);\n        };\n\n        request.onupgradeneeded = function (event) {\n          return _this.onDbUpgrade(request, event);\n        };\n      });\n    }\n\n    return this.dbPromise;\n  };\n\n  return DbInterface;\n}();\n/** Promisifies an IDBRequest. Resolves with the IDBRequest's result. */\n\n\nfunction promisify(request) {\n  return new Promise(function (resolve, reject) {\n    request.onsuccess = function () {\n      resolve(request.result);\n    };\n\n    request.onerror = function () {\n      reject(request.error);\n    };\n  });\n}\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nvar TokenDetailsModel =\n/** @class */\nfunction (_super) {\n  __extends(TokenDetailsModel, _super);\n\n  function TokenDetailsModel(app) {\n    var _this = _super.call(this) || this;\n\n    _this.app = app;\n    _this.dbName = 'fcm_token_details_db';\n    _this.dbVersion = 4;\n    _this.objectStoreName = 'fcm_token_object_Store';\n    return _this;\n  }\n\n  TokenDetailsModel.prototype.onDbUpgrade = function (request, event) {\n    var db = request.result; // Lack of 'break' statements is intentional.\n\n    switch (event.oldVersion) {\n      case 0:\n        {\n          // New IDB instance\n          var objectStore = db.createObjectStore(this.objectStoreName, {\n            keyPath: 'swScope'\n          }); // Make sure the sender ID can be searched\n\n          objectStore.createIndex('fcmSenderId', 'fcmSenderId', {\n            unique: false\n          });\n          objectStore.createIndex('fcmToken', 'fcmToken', {\n            unique: true\n          });\n        }\n\n      case 1:\n        {\n          // Prior to version 2, we were using either 'fcm_token_details_db'\n          // or 'undefined' as the database name due to bug in the SDK\n          // So remove the old tokens and databases.\n          cleanV1(this.app);\n        }\n\n      case 2:\n        {\n          // Update from v2 to v4 directly in a single openCursor request.\n          // We need to do this because for some reason, doing a subsequent update on the same data\n          // in the same transaction drops the first update.\n          var objectStore = request.transaction.objectStore(this.objectStoreName);\n          var cursorRequest_1 = objectStore.openCursor();\n\n          cursorRequest_1.onsuccess = function () {\n            var cursor = cursorRequest_1.result;\n\n            if (cursor) {\n              var value = cursor.value;\n\n              var newValue = __assign({}, value);\n\n              if (!value.createTime) {\n                newValue.createTime = Date.now();\n              }\n\n              if (typeof value.vapidKey === 'string') {\n                newValue.vapidKey = base64ToArrayBuffer(value.vapidKey);\n              }\n\n              if (typeof value.auth === 'string') {\n                newValue.auth = base64ToArrayBuffer(value.auth).buffer;\n              }\n\n              if (typeof value.auth === 'string') {\n                newValue.p256dh = base64ToArrayBuffer(value.p256dh).buffer;\n              }\n\n              if (typeof value.fcmPushSet === 'string') {\n                delete newValue.fcmPushSet;\n              }\n\n              cursor.update(newValue);\n              cursor[\"continue\"]();\n            }\n          }; // Break here as we've already updated to v4.\n\n\n          break;\n        }\n\n      case 3:\n        {\n          // Update from V3 to V4.\n          var objectStore = request.transaction.objectStore(this.objectStoreName);\n          var cursorRequest_2 = objectStore.openCursor();\n\n          cursorRequest_2.onsuccess = function () {\n            var cursor = cursorRequest_2.result;\n\n            if (cursor) {\n              var value = cursor.value;\n\n              var newValue = __assign({}, value);\n\n              if (typeof value.fcmPushSet === 'string') {\n                delete newValue.fcmPushSet;\n              }\n\n              cursor.update(newValue);\n              cursor[\"continue\"]();\n            }\n          };\n        }\n    }\n  };\n  /**\r\n   * Given a token, this method will look up the details in indexedDB.\r\n   */\n\n\n  TokenDetailsModel.prototype.getTokenDetailsFromToken = function (fcmToken) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        if (!fcmToken) {\n          throw errorFactory.create(\"bad-token\"\n          /* BAD_TOKEN */\n          );\n        }\n\n        validateInputs({\n          fcmToken: fcmToken\n        });\n        return [2\n        /*return*/\n        , this.getIndex('fcmToken', fcmToken)];\n      });\n    });\n  };\n  /**\r\n   * Given a service worker scope, this method will look up the details in\r\n   * indexedDB.\r\n   * @return The details associated with that token.\r\n   */\n\n\n  TokenDetailsModel.prototype.getTokenDetailsFromSWScope = function (swScope) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        if (!swScope) {\n          throw errorFactory.create(\"bad-scope\"\n          /* BAD_SCOPE */\n          );\n        }\n\n        validateInputs({\n          swScope: swScope\n        });\n        return [2\n        /*return*/\n        , this.get(swScope)];\n      });\n    });\n  };\n  /**\r\n   * Save the details for the fcm token for re-use at a later date.\r\n   * @param input A plain js object containing args to save.\r\n   */\n\n\n  TokenDetailsModel.prototype.saveTokenDetails = function (tokenDetails) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        if (!tokenDetails.swScope) {\n          throw errorFactory.create(\"bad-scope\"\n          /* BAD_SCOPE */\n          );\n        }\n\n        if (!tokenDetails.vapidKey) {\n          throw errorFactory.create(\"bad-vapid-key\"\n          /* BAD_VAPID_KEY */\n          );\n        }\n\n        if (!tokenDetails.endpoint || !tokenDetails.auth || !tokenDetails.p256dh) {\n          throw errorFactory.create(\"bad-subscription\"\n          /* BAD_SUBSCRIPTION */\n          );\n        }\n\n        if (!tokenDetails.fcmSenderId) {\n          throw errorFactory.create(\"bad-sender-id\"\n          /* BAD_SENDER_ID */\n          );\n        }\n\n        if (!tokenDetails.fcmToken) {\n          throw errorFactory.create(\"bad-token\"\n          /* BAD_TOKEN */\n          );\n        }\n\n        validateInputs(tokenDetails);\n        return [2\n        /*return*/\n        , this.put(tokenDetails)];\n      });\n    });\n  };\n  /**\r\n   * This method deletes details of the current FCM token.\r\n   * It's returning a promise in case we need to move to an async\r\n   * method for deleting at a later date.\r\n   *\r\n   * @return Resolves once the FCM token details have been deleted and returns\r\n   * the deleted details.\r\n   */\n\n\n  TokenDetailsModel.prototype.deleteToken = function (token) {\n    return __awaiter(this, void 0, void 0, function () {\n      var details;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            if (typeof token !== 'string' || token.length === 0) {\n              return [2\n              /*return*/\n              , Promise.reject(errorFactory.create(\"invalid-delete-token\"\n              /* INVALID_DELETE_TOKEN */\n              ))];\n            }\n\n            return [4\n            /*yield*/\n            , this.getTokenDetailsFromToken(token)];\n\n          case 1:\n            details = _a.sent();\n\n            if (!details) {\n              throw errorFactory.create(\"delete-token-not-found\"\n              /* DELETE_TOKEN_NOT_FOUND */\n              );\n            }\n\n            return [4\n            /*yield*/\n            , this[\"delete\"](details.swScope)];\n\n          case 2:\n            _a.sent();\n\n            return [2\n            /*return*/\n            , details];\n        }\n      });\n    });\n  };\n\n  return TokenDetailsModel;\n}(DbInterface);\n/**\r\n * This method takes an object and will check for known arguments and\r\n * validate the input.\r\n * @return Promise that resolves if input is valid, rejects otherwise.\r\n */\n\n\nfunction validateInputs(input) {\n  if (input.fcmToken) {\n    if (typeof input.fcmToken !== 'string' || input.fcmToken.length === 0) {\n      throw errorFactory.create(\"bad-token\"\n      /* BAD_TOKEN */\n      );\n    }\n  }\n\n  if (input.swScope) {\n    if (typeof input.swScope !== 'string' || input.swScope.length === 0) {\n      throw errorFactory.create(\"bad-scope\"\n      /* BAD_SCOPE */\n      );\n    }\n  }\n\n  if (input.vapidKey) {\n    if (!(input.vapidKey instanceof Uint8Array) || input.vapidKey.length !== 65) {\n      throw errorFactory.create(\"bad-vapid-key\"\n      /* BAD_VAPID_KEY */\n      );\n    }\n  }\n\n  if (input.endpoint) {\n    if (typeof input.endpoint !== 'string' || input.endpoint.length === 0) {\n      throw errorFactory.create(\"bad-subscription\"\n      /* BAD_SUBSCRIPTION */\n      );\n    }\n  }\n\n  if (input.auth) {\n    if (!(input.auth instanceof ArrayBuffer)) {\n      throw errorFactory.create(\"bad-subscription\"\n      /* BAD_SUBSCRIPTION */\n      );\n    }\n  }\n\n  if (input.p256dh) {\n    if (!(input.p256dh instanceof ArrayBuffer)) {\n      throw errorFactory.create(\"bad-subscription\"\n      /* BAD_SUBSCRIPTION */\n      );\n    }\n  }\n\n  if (input.fcmSenderId) {\n    if (typeof input.fcmSenderId !== 'string' || input.fcmSenderId.length === 0) {\n      throw errorFactory.create(\"bad-sender-id\"\n      /* BAD_SENDER_ID */\n      );\n    }\n  }\n}\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nvar UNCOMPRESSED_PUBLIC_KEY_SIZE = 65;\n\nvar VapidDetailsModel =\n/** @class */\nfunction (_super) {\n  __extends(VapidDetailsModel, _super);\n\n  function VapidDetailsModel() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.dbName = 'fcm_vapid_details_db';\n    _this.dbVersion = 1;\n    _this.objectStoreName = 'fcm_vapid_object_Store';\n    return _this;\n  }\n\n  VapidDetailsModel.prototype.onDbUpgrade = function (request) {\n    var db = request.result;\n    db.createObjectStore(this.objectStoreName, {\n      keyPath: 'swScope'\n    });\n  };\n  /**\r\n   * Given a service worker scope, this method will look up the vapid key\r\n   * in indexedDB.\r\n   */\n\n\n  VapidDetailsModel.prototype.getVapidFromSWScope = function (swScope) {\n    return __awaiter(this, void 0, void 0, function () {\n      var result;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            if (typeof swScope !== 'string' || swScope.length === 0) {\n              throw errorFactory.create(\"bad-scope\"\n              /* BAD_SCOPE */\n              );\n            }\n\n            return [4\n            /*yield*/\n            , this.get(swScope)];\n\n          case 1:\n            result = _a.sent();\n            return [2\n            /*return*/\n            , result ? result.vapidKey : undefined];\n        }\n      });\n    });\n  };\n  /**\r\n   * Save a vapid key against a swScope for later date.\r\n   */\n\n\n  VapidDetailsModel.prototype.saveVapidDetails = function (swScope, vapidKey) {\n    return __awaiter(this, void 0, void 0, function () {\n      var details;\n      return __generator(this, function (_a) {\n        if (typeof swScope !== 'string' || swScope.length === 0) {\n          throw errorFactory.create(\"bad-scope\"\n          /* BAD_SCOPE */\n          );\n        }\n\n        if (vapidKey === null || vapidKey.length !== UNCOMPRESSED_PUBLIC_KEY_SIZE) {\n          throw errorFactory.create(\"bad-vapid-key\"\n          /* BAD_VAPID_KEY */\n          );\n        }\n\n        details = {\n          swScope: swScope,\n          vapidKey: vapidKey\n        };\n        return [2\n        /*return*/\n        , this.put(details)];\n      });\n    });\n  };\n  /**\r\n   * This method deletes details of the current FCM VAPID key for a SW scope.\r\n   * Resolves once the scope/vapid details have been deleted and returns the\r\n   * deleted vapid key.\r\n   */\n\n\n  VapidDetailsModel.prototype.deleteVapidDetails = function (swScope) {\n    return __awaiter(this, void 0, void 0, function () {\n      var vapidKey;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , this.getVapidFromSWScope(swScope)];\n\n          case 1:\n            vapidKey = _a.sent();\n\n            if (!vapidKey) {\n              throw errorFactory.create(\"delete-scope-not-found\"\n              /* DELETE_SCOPE_NOT_FOUND */\n              );\n            }\n\n            return [4\n            /*yield*/\n            , this[\"delete\"](swScope)];\n\n          case 2:\n            _a.sent();\n\n            return [2\n            /*return*/\n            , vapidKey];\n        }\n      });\n    });\n  };\n\n  return VapidDetailsModel;\n}(DbInterface);\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n// Token should be refreshed once a week.\n\n\nvar TOKEN_EXPIRATION_MILLIS = 7 * 24 * 60 * 60 * 1000; // 7 days\n\nvar BaseController =\n/** @class */\nfunction () {\n  function BaseController(app) {\n    var _this = this;\n\n    this.app = app;\n    this.vapidDetailsModel = new VapidDetailsModel();\n    this.subscriptionManager = new SubscriptionManager();\n\n    if (!app.options.messagingSenderId || typeof app.options.messagingSenderId !== 'string') {\n      throw errorFactory.create(\"bad-sender-id\"\n      /* BAD_SENDER_ID */\n      );\n    }\n\n    this.INTERNAL = {\n      \"delete\": function _delete() {\n        return _this[\"delete\"]();\n      }\n    };\n    this.tokenDetailsModel = new TokenDetailsModel(app);\n  }\n\n  BaseController.prototype.getToken = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var currentPermission, swReg, publicVapidKey, pushSubscription, tokenDetails;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            currentPermission = this.getNotificationPermission_();\n\n            if (currentPermission === 'denied') {\n              throw errorFactory.create(\"notifications-blocked\"\n              /* NOTIFICATIONS_BLOCKED */\n              );\n            } else if (currentPermission !== 'granted') {\n              // We must wait for permission to be granted\n              return [2\n              /*return*/\n              , null];\n            }\n\n            return [4\n            /*yield*/\n            , this.getSWRegistration_()];\n\n          case 1:\n            swReg = _a.sent();\n            return [4\n            /*yield*/\n            , this.getPublicVapidKey_()];\n\n          case 2:\n            publicVapidKey = _a.sent();\n            return [4\n            /*yield*/\n            , this.getPushSubscription(swReg, publicVapidKey)];\n\n          case 3:\n            pushSubscription = _a.sent();\n            return [4\n            /*yield*/\n            , this.tokenDetailsModel.getTokenDetailsFromSWScope(swReg.scope)];\n\n          case 4:\n            tokenDetails = _a.sent();\n\n            if (tokenDetails) {\n              return [2\n              /*return*/\n              , this.manageExistingToken(swReg, pushSubscription, publicVapidKey, tokenDetails)];\n            }\n\n            return [2\n            /*return*/\n            , this.getNewToken(swReg, pushSubscription, publicVapidKey)];\n        }\n      });\n    });\n  };\n  /**\r\n   * manageExistingToken is triggered if there's an existing FCM token in the\r\n   * database and it can take 3 different actions:\r\n   * 1) Retrieve the existing FCM token from the database.\r\n   * 2) If VAPID details have changed: Delete the existing token and create a\r\n   * new one with the new VAPID key.\r\n   * 3) If the database cache is invalidated: Send a request to FCM to update\r\n   * the token, and to check if the token is still valid on FCM-side.\r\n   */\n\n\n  BaseController.prototype.manageExistingToken = function (swReg, pushSubscription, publicVapidKey, tokenDetails) {\n    return __awaiter(this, void 0, void 0, function () {\n      var isTokenValid, now;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            isTokenValid = isTokenStillValid(pushSubscription, publicVapidKey, tokenDetails);\n            if (!isTokenValid) return [3\n            /*break*/\n            , 1];\n            now = Date.now();\n\n            if (now < tokenDetails.createTime + TOKEN_EXPIRATION_MILLIS) {\n              return [2\n              /*return*/\n              , tokenDetails.fcmToken];\n            } else {\n              return [2\n              /*return*/\n              , this.updateToken(swReg, pushSubscription, publicVapidKey, tokenDetails)];\n            }\n\n          case 1:\n            // If the token is no longer valid (for example if the VAPID details\n            // have changed), delete the existing token from the FCM client and server\n            // database. No need to unsubscribe from the Service Worker as we have a\n            // good push subscription that we'd like to use in getNewToken.\n            return [4\n            /*yield*/\n            , this.deleteTokenFromDB(tokenDetails.fcmToken)];\n\n          case 2:\n            // If the token is no longer valid (for example if the VAPID details\n            // have changed), delete the existing token from the FCM client and server\n            // database. No need to unsubscribe from the Service Worker as we have a\n            // good push subscription that we'd like to use in getNewToken.\n            _a.sent();\n\n            return [2\n            /*return*/\n            , this.getNewToken(swReg, pushSubscription, publicVapidKey)];\n\n          case 3:\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  BaseController.prototype.updateToken = function (swReg, pushSubscription, publicVapidKey, tokenDetails) {\n    return __awaiter(this, void 0, void 0, function () {\n      var updatedToken, allDetails, e_1;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            _a.trys.push([0, 4,, 6]);\n\n            return [4\n            /*yield*/\n            , this.subscriptionManager.updateToken(tokenDetails, this.app, pushSubscription, publicVapidKey)];\n\n          case 1:\n            updatedToken = _a.sent();\n            allDetails = {\n              swScope: swReg.scope,\n              vapidKey: publicVapidKey,\n              fcmSenderId: this.app.options.messagingSenderId,\n              fcmToken: updatedToken,\n              createTime: Date.now(),\n              endpoint: pushSubscription.endpoint,\n              auth: pushSubscription.getKey('auth'),\n              p256dh: pushSubscription.getKey('p256dh')\n            };\n            return [4\n            /*yield*/\n            , this.tokenDetailsModel.saveTokenDetails(allDetails)];\n\n          case 2:\n            _a.sent();\n\n            return [4\n            /*yield*/\n            , this.vapidDetailsModel.saveVapidDetails(swReg.scope, publicVapidKey)];\n\n          case 3:\n            _a.sent();\n\n            return [2\n            /*return*/\n            , updatedToken];\n\n          case 4:\n            e_1 = _a.sent();\n            return [4\n            /*yield*/\n            , this.deleteToken(tokenDetails.fcmToken)];\n\n          case 5:\n            _a.sent();\n\n            throw e_1;\n\n          case 6:\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  BaseController.prototype.getNewToken = function (swReg, pushSubscription, publicVapidKey) {\n    return __awaiter(this, void 0, void 0, function () {\n      var newToken, allDetails;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , this.subscriptionManager.getToken(this.app, pushSubscription, publicVapidKey)];\n\n          case 1:\n            newToken = _a.sent();\n            allDetails = {\n              swScope: swReg.scope,\n              vapidKey: publicVapidKey,\n              fcmSenderId: this.app.options.messagingSenderId,\n              fcmToken: newToken,\n              createTime: Date.now(),\n              endpoint: pushSubscription.endpoint,\n              auth: pushSubscription.getKey('auth'),\n              p256dh: pushSubscription.getKey('p256dh')\n            };\n            return [4\n            /*yield*/\n            , this.tokenDetailsModel.saveTokenDetails(allDetails)];\n\n          case 2:\n            _a.sent();\n\n            return [4\n            /*yield*/\n            , this.vapidDetailsModel.saveVapidDetails(swReg.scope, publicVapidKey)];\n\n          case 3:\n            _a.sent();\n\n            return [2\n            /*return*/\n            , newToken];\n        }\n      });\n    });\n  };\n  /**\r\n   * This method deletes tokens that the token manager looks after,\r\n   * unsubscribes the token from FCM  and then unregisters the push\r\n   * subscription if it exists. It returns a promise that indicates\r\n   * whether or not the unsubscribe request was processed successfully.\r\n   */\n\n\n  BaseController.prototype.deleteToken = function (token) {\n    return __awaiter(this, void 0, void 0, function () {\n      var registration, pushSubscription;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            // Delete the token details from the database.\n            return [4\n            /*yield*/\n            , this.deleteTokenFromDB(token)];\n\n          case 1:\n            // Delete the token details from the database.\n            _a.sent();\n\n            return [4\n            /*yield*/\n            , this.getSWRegistration_()];\n\n          case 2:\n            registration = _a.sent();\n            if (!registration) return [3\n            /*break*/\n            , 4];\n            return [4\n            /*yield*/\n            , registration.pushManager.getSubscription()];\n\n          case 3:\n            pushSubscription = _a.sent();\n\n            if (pushSubscription) {\n              return [2\n              /*return*/\n              , pushSubscription.unsubscribe()];\n            }\n\n            _a.label = 4;\n\n          case 4:\n            // If there's no SW, consider it a success.\n            return [2\n            /*return*/\n            , true];\n        }\n      });\n    });\n  };\n  /**\r\n   * This method will delete the token from the client database, and make a\r\n   * call to FCM to remove it from the server DB. Does not temper with the\r\n   * push subscription.\r\n   */\n\n\n  BaseController.prototype.deleteTokenFromDB = function (token) {\n    return __awaiter(this, void 0, void 0, function () {\n      var tokenDetails;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , this.tokenDetailsModel.deleteToken(token)];\n\n          case 1:\n            tokenDetails = _a.sent();\n            return [4\n            /*yield*/\n            , this.subscriptionManager.deleteToken(this.app, tokenDetails)];\n\n          case 2:\n            _a.sent();\n\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n  /**\r\n   * Gets a PushSubscription for the current user.\r\n   */\n\n\n  BaseController.prototype.getPushSubscription = function (swRegistration, publicVapidKey) {\n    return __awaiter(this, void 0, void 0, function () {\n      var subscription;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , swRegistration.pushManager.getSubscription()];\n\n          case 1:\n            subscription = _a.sent();\n\n            if (subscription) {\n              return [2\n              /*return*/\n              , subscription];\n            }\n\n            return [2\n            /*return*/\n            , swRegistration.pushManager.subscribe({\n              userVisibleOnly: true,\n              applicationServerKey: publicVapidKey\n            })];\n        }\n      });\n    });\n  }; //\n  // The following methods should only be available in the window.\n  //\n\n  /**\r\n   * @deprecated Use Notification.requestPermission() instead.\r\n   * https://developer.mozilla.org/en-US/docs/Web/API/Notification/requestPermission\r\n   */\n\n\n  BaseController.prototype.requestPermission = function () {\n    throw errorFactory.create(\"only-available-in-window\"\n    /* AVAILABLE_IN_WINDOW */\n    );\n  };\n\n  BaseController.prototype.useServiceWorker = function (_registration) {\n    throw errorFactory.create(\"only-available-in-window\"\n    /* AVAILABLE_IN_WINDOW */\n    );\n  };\n\n  BaseController.prototype.usePublicVapidKey = function (_b64PublicKey) {\n    throw errorFactory.create(\"only-available-in-window\"\n    /* AVAILABLE_IN_WINDOW */\n    );\n  };\n\n  BaseController.prototype.onMessage = function (_nextOrObserver, _error, _completed) {\n    throw errorFactory.create(\"only-available-in-window\"\n    /* AVAILABLE_IN_WINDOW */\n    );\n  };\n\n  BaseController.prototype.onTokenRefresh = function (_nextOrObserver, _error, _completed) {\n    throw errorFactory.create(\"only-available-in-window\"\n    /* AVAILABLE_IN_WINDOW */\n    );\n  }; //\n  // The following methods are used by the service worker only.\n  //\n\n\n  BaseController.prototype.setBackgroundMessageHandler = function (_callback) {\n    throw errorFactory.create(\"only-available-in-sw\"\n    /* AVAILABLE_IN_SW */\n    );\n  }; //\n  // The following methods are used by the service themselves and not exposed\n  // publicly or not expected to be used by developers.\n  //\n\n  /**\r\n   * This method is required to adhere to the Firebase interface.\r\n   * It closes any currently open indexdb database connections.\r\n   */\n\n\n  BaseController.prototype[\"delete\"] = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , Promise.all([this.tokenDetailsModel.closeDatabase(), this.vapidDetailsModel.closeDatabase()])];\n\n          case 1:\n            _a.sent();\n\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n  /**\r\n   * Returns the current Notification Permission state.\r\n   */\n\n\n  BaseController.prototype.getNotificationPermission_ = function () {\n    return Notification.permission;\n  };\n\n  BaseController.prototype.getTokenDetailsModel = function () {\n    return this.tokenDetailsModel;\n  };\n\n  BaseController.prototype.getVapidDetailsModel = function () {\n    return this.vapidDetailsModel;\n  }; // Visible for testing\n  // TODO: make protected\n\n\n  BaseController.prototype.getSubscriptionManager = function () {\n    return this.subscriptionManager;\n  };\n\n  return BaseController;\n}();\n/**\r\n * Checks if the tokenDetails match the details provided in the clients.\r\n */\n\n\nfunction isTokenStillValid(pushSubscription, publicVapidKey, tokenDetails) {\n  if (!tokenDetails.vapidKey || !isArrayBufferEqual(publicVapidKey.buffer, tokenDetails.vapidKey.buffer)) {\n    return false;\n  }\n\n  var isEndpointEqual = pushSubscription.endpoint === tokenDetails.endpoint;\n  var isAuthEqual = isArrayBufferEqual(pushSubscription.getKey('auth'), tokenDetails.auth);\n  var isP256dhEqual = isArrayBufferEqual(pushSubscription.getKey('p256dh'), tokenDetails.p256dh);\n  return isEndpointEqual && isAuthEqual && isP256dhEqual;\n}\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nvar FCM_MSG = 'FCM_MSG';\n\nvar SwController =\n/** @class */\nfunction (_super) {\n  __extends(SwController, _super);\n\n  function SwController(app) {\n    var _this = _super.call(this, app) || this;\n\n    _this.bgMessageHandler = null;\n    self.addEventListener('push', function (e) {\n      _this.onPush(e);\n    });\n    self.addEventListener('pushsubscriptionchange', function (e) {\n      _this.onSubChange(e);\n    });\n    self.addEventListener('notificationclick', function (e) {\n      _this.onNotificationClick(e);\n    });\n    return _this;\n  } // Visible for testing\n  // TODO: Make private\n\n\n  SwController.prototype.onPush = function (event) {\n    event.waitUntil(this.onPush_(event));\n  }; // Visible for testing\n  // TODO: Make private\n\n\n  SwController.prototype.onSubChange = function (event) {\n    event.waitUntil(this.onSubChange_(event));\n  }; // Visible for testing\n  // TODO: Make private\n\n\n  SwController.prototype.onNotificationClick = function (event) {\n    event.waitUntil(this.onNotificationClick_(event));\n  };\n  /**\r\n   * A handler for push events that shows notifications based on the content of\r\n   * the payload.\r\n   *\r\n   * The payload must be a JSON-encoded Object with a `notification` key. The\r\n   * value of the `notification` property will be used as the NotificationOptions\r\n   * object passed to showNotification. Additionally, the `title` property of the\r\n   * notification object will be used as the title.\r\n   *\r\n   * If there is no notification data in the payload then no notification will be\r\n   * shown.\r\n   */\n\n\n  SwController.prototype.onPush_ = function (event) {\n    return __awaiter(this, void 0, void 0, function () {\n      var msgPayload, hasVisibleClients, notificationDetails, notificationTitle, reg, actions, maxActions;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            if (!event.data) {\n              return [2\n              /*return*/\n              ];\n            }\n\n            try {\n              msgPayload = event.data.json();\n            } catch (err) {\n              // Not JSON so not an FCM message\n              return [2\n              /*return*/\n              ];\n            }\n\n            return [4\n            /*yield*/\n            , this.hasVisibleClients_()];\n\n          case 1:\n            hasVisibleClients = _a.sent();\n\n            if (hasVisibleClients) {\n              // App in foreground. Send to page.\n              return [2\n              /*return*/\n              , this.sendMessageToWindowClients_(msgPayload)];\n            }\n\n            notificationDetails = this.getNotificationData_(msgPayload);\n            if (!notificationDetails) return [3\n            /*break*/\n            , 3];\n            notificationTitle = notificationDetails.title || '';\n            return [4\n            /*yield*/\n            , this.getSWRegistration_()];\n\n          case 2:\n            reg = _a.sent();\n            actions = notificationDetails.actions;\n            maxActions = Notification.maxActions;\n\n            if (actions && maxActions && actions.length > maxActions) {\n              console.warn(\"This browser only supports \" + maxActions + \" actions.\" + \"The remaining actions will not be displayed.\");\n            }\n\n            return [2\n            /*return*/\n            , reg.showNotification(notificationTitle, notificationDetails)];\n\n          case 3:\n            if (!this.bgMessageHandler) return [3\n            /*break*/\n            , 5];\n            return [4\n            /*yield*/\n            , this.bgMessageHandler(msgPayload)];\n\n          case 4:\n            _a.sent();\n\n            return [2\n            /*return*/\n            ];\n\n          case 5:\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  SwController.prototype.onSubChange_ = function (_event) {\n    return __awaiter(this, void 0, void 0, function () {\n      var registration, err_1, err_2, tokenDetailsModel, tokenDetails;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            _a.trys.push([0, 2,, 3]);\n\n            return [4\n            /*yield*/\n            , this.getSWRegistration_()];\n\n          case 1:\n            registration = _a.sent();\n            return [3\n            /*break*/\n            , 3];\n\n          case 2:\n            err_1 = _a.sent();\n            throw errorFactory.create(\"unable-to-resubscribe\"\n            /* UNABLE_TO_RESUBSCRIBE */\n            , {\n              errorInfo: err_1\n            });\n\n          case 3:\n            _a.trys.push([3, 5,, 8]);\n\n            return [4\n            /*yield*/\n            , registration.pushManager.getSubscription()];\n\n          case 4:\n            _a.sent();\n\n            return [3\n            /*break*/\n            , 8];\n\n          case 5:\n            err_2 = _a.sent();\n            tokenDetailsModel = this.getTokenDetailsModel();\n            return [4\n            /*yield*/\n            , tokenDetailsModel.getTokenDetailsFromSWScope(registration.scope)];\n\n          case 6:\n            tokenDetails = _a.sent();\n\n            if (!tokenDetails) {\n              // This should rarely occure, but could if indexedDB\n              // is corrupted or wiped\n              throw err_2;\n            } // Attempt to delete the token if we know it's bad\n\n\n            return [4\n            /*yield*/\n            , this.deleteToken(tokenDetails.fcmToken)];\n\n          case 7:\n            // Attempt to delete the token if we know it's bad\n            _a.sent();\n\n            throw err_2;\n\n          case 8:\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  SwController.prototype.onNotificationClick_ = function (event) {\n    return __awaiter(this, void 0, void 0, function () {\n      var msgPayload, link, windowClient, internalMsg;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            if (!event.notification || !event.notification.data || !event.notification.data[FCM_MSG]) {\n              // Not an FCM notification, do nothing.\n              return [2\n              /*return*/\n              ];\n            } else if (event.action) {\n              // User clicked on an action button.\n              // This will allow devs to act on action button clicks by using a custom\n              // onNotificationClick listener that they define.\n              return [2\n              /*return*/\n              ];\n            } // Prevent other listeners from receiving the event\n\n\n            event.stopImmediatePropagation();\n            event.notification.close();\n            msgPayload = event.notification.data[FCM_MSG];\n\n            if (!msgPayload.notification) {\n              // Nothing to do.\n              return [2\n              /*return*/\n              ];\n            }\n\n            link = msgPayload.fcmOptions && msgPayload.fcmOptions.link || msgPayload.notification.click_action;\n\n            if (!link) {\n              if (msgPayload.data && FN_CAMPAIGN_ID in msgPayload.data) {\n                link = self.location.origin;\n              } else {\n                // Nothing to do.\n                return [2\n                /*return*/\n                ];\n              }\n            }\n\n            return [4\n            /*yield*/\n            , this.getWindowClient_(link)];\n\n          case 1:\n            windowClient = _a.sent();\n            if (!!windowClient) return [3\n            /*break*/\n            , 4];\n            return [4\n            /*yield*/\n            , self.clients.openWindow(link)];\n\n          case 2:\n            // Unable to find window client so need to open one.\n            windowClient = _a.sent(); // Wait three seconds for the client to initialize and set up the message\n            // handler so that it can receive the message.\n\n            return [4\n            /*yield*/\n            , sleep(3000)];\n\n          case 3:\n            // Wait three seconds for the client to initialize and set up the message\n            // handler so that it can receive the message.\n            _a.sent();\n\n            return [3\n            /*break*/\n            , 6];\n\n          case 4:\n            return [4\n            /*yield*/\n            , windowClient.focus()];\n\n          case 5:\n            windowClient = _a.sent();\n            _a.label = 6;\n\n          case 6:\n            if (!windowClient) {\n              // Window Client will not be returned if it's for a third party origin.\n              return [2\n              /*return*/\n              ];\n            } // Delete notification and fcmOptions data from payload before sending to\n            // the page.\n\n\n            delete msgPayload.notification;\n            delete msgPayload.fcmOptions;\n            internalMsg = createNewMsg(MessageType.NOTIFICATION_CLICKED, msgPayload); // Attempt to send a message to the client to handle the data\n            // Is affected by: https://github.com/slightlyoff/ServiceWorker/issues/728\n\n            return [2\n            /*return*/\n            , this.attemptToMessageClient_(windowClient, internalMsg)];\n        }\n      });\n    });\n  }; // Visible for testing\n  // TODO: Make private\n\n\n  SwController.prototype.getNotificationData_ = function (msgPayload) {\n    var _a;\n\n    if (!msgPayload) {\n      return;\n    }\n\n    if (typeof msgPayload.notification !== 'object') {\n      return;\n    }\n\n    var notificationInformation = __assign({}, msgPayload.notification); // Put the message payload under FCM_MSG name so we can identify the\n    // notification as being an FCM notification vs a notification from\n    // somewhere else (i.e. normal web push or developer generated\n    // notification).\n\n\n    notificationInformation.data = __assign(__assign({}, msgPayload.notification.data), (_a = {}, _a[FCM_MSG] = msgPayload, _a));\n    return notificationInformation;\n  };\n  /**\r\n   * Calling setBackgroundMessageHandler will opt in to some specific\r\n   * behaviours.\r\n   * 1.) If a notification doesn't need to be shown due to a window already\r\n   * being visible, then push messages will be sent to the page.\r\n   * 2.) If a notification needs to be shown, and the message contains no\r\n   * notification data this method will be called\r\n   * and the promise it returns will be passed to event.waitUntil.\r\n   * If you do not set this callback then all push messages will let and the\r\n   * developer can handle them in a their own 'push' event callback\r\n   *\r\n   * @param callback The callback to be called when a push message is received\r\n   * and a notification must be shown. The callback will be given the data from\r\n   * the push message.\r\n   */\n\n\n  SwController.prototype.setBackgroundMessageHandler = function (callback) {\n    if (!callback || typeof callback !== 'function') {\n      throw errorFactory.create(\"bg-handler-function-expected\"\n      /* BG_HANDLER_FUNCTION_EXPECTED */\n      );\n    }\n\n    this.bgMessageHandler = callback;\n  };\n  /**\r\n   * @param url The URL to look for when focusing a client.\r\n   * @return Returns an existing window client or a newly opened WindowClient.\r\n   */\n  // Visible for testing\n  // TODO: Make private\n\n\n  SwController.prototype.getWindowClient_ = function (url) {\n    return __awaiter(this, void 0, void 0, function () {\n      var parsedURL, clientList, suitableClient, i, parsedClientUrl;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            parsedURL = new URL(url, self.location.href).href;\n            return [4\n            /*yield*/\n            , getClientList()];\n\n          case 1:\n            clientList = _a.sent();\n            suitableClient = null;\n\n            for (i = 0; i < clientList.length; i++) {\n              parsedClientUrl = new URL(clientList[i].url, self.location.href).href;\n\n              if (parsedClientUrl === parsedURL) {\n                suitableClient = clientList[i];\n                break;\n              }\n            }\n\n            return [2\n            /*return*/\n            , suitableClient];\n        }\n      });\n    });\n  };\n  /**\r\n   * This message will attempt to send the message to a window client.\r\n   * @param client The WindowClient to send the message to.\r\n   * @param message The message to send to the client.\r\n   * @returns Returns a promise that resolves after sending the message. This\r\n   * does not guarantee that the message was successfully received.\r\n   */\n  // Visible for testing\n  // TODO: Make private\n\n\n  SwController.prototype.attemptToMessageClient_ = function (client, message) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        // NOTE: This returns a promise in case this API is abstracted later on to\n        // do additional work\n        if (!client) {\n          throw errorFactory.create(\"no-window-client-to-msg\"\n          /* NO_WINDOW_CLIENT_TO_MSG */\n          );\n        }\n\n        client.postMessage(message);\n        return [2\n        /*return*/\n        ];\n      });\n    });\n  };\n  /**\r\n   * @returns If there is currently a visible WindowClient, this method will\r\n   * resolve to true, otherwise false.\r\n   */\n  // Visible for testing\n  // TODO: Make private\n\n\n  SwController.prototype.hasVisibleClients_ = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var clientList;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , getClientList()];\n\n          case 1:\n            clientList = _a.sent();\n            return [2\n            /*return*/\n            , clientList.some(function (client) {\n              return client.visibilityState === 'visible' && // Ignore chrome-extension clients as that matches the background pages\n              // of extensions, which are always considered visible.\n              !client.url.startsWith('chrome-extension://');\n            })];\n        }\n      });\n    });\n  };\n  /**\r\n   * @param msgPayload The data from the push event that should be sent to all\r\n   * available pages.\r\n   * @returns Returns a promise that resolves once the message has been sent to\r\n   * all WindowClients.\r\n   */\n  // Visible for testing\n  // TODO: Make private\n\n\n  SwController.prototype.sendMessageToWindowClients_ = function (msgPayload) {\n    return __awaiter(this, void 0, void 0, function () {\n      var clientList, internalMsg;\n\n      var _this = this;\n\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , getClientList()];\n\n          case 1:\n            clientList = _a.sent();\n            internalMsg = createNewMsg(MessageType.PUSH_MSG_RECEIVED, msgPayload);\n            return [4\n            /*yield*/\n            , Promise.all(clientList.map(function (client) {\n              return _this.attemptToMessageClient_(client, internalMsg);\n            }))];\n\n          case 2:\n            _a.sent();\n\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n  /**\r\n   * This will register the default service worker and return the registration.\r\n   * @return he service worker registration to be used for the push service.\r\n   */\n\n\n  SwController.prototype.getSWRegistration_ = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        return [2\n        /*return*/\n        , self.registration];\n      });\n    });\n  };\n  /**\r\n   * This will return the default VAPID key or the uint8array version of the\r\n   * public VAPID key provided by the developer.\r\n   */\n\n\n  SwController.prototype.getPublicVapidKey_ = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var swReg, vapidKeyFromDatabase;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , this.getSWRegistration_()];\n\n          case 1:\n            swReg = _a.sent();\n\n            if (!swReg) {\n              throw errorFactory.create(\"sw-registration-expected\"\n              /* SW_REGISTRATION_EXPECTED */\n              );\n            }\n\n            return [4\n            /*yield*/\n            , this.getVapidDetailsModel().getVapidFromSWScope(swReg.scope)];\n\n          case 2:\n            vapidKeyFromDatabase = _a.sent();\n\n            if (vapidKeyFromDatabase == null) {\n              return [2\n              /*return*/\n              , DEFAULT_PUBLIC_VAPID_KEY];\n            }\n\n            return [2\n            /*return*/\n            , vapidKeyFromDatabase];\n        }\n      });\n    });\n  };\n\n  return SwController;\n}(BaseController);\n\nfunction getClientList() {\n  return self.clients.matchAll({\n    type: 'window',\n    includeUncontrolled: true // TS doesn't know that \"type: 'window'\" means it'll return WindowClient[]\n\n  });\n}\n\nfunction createNewMsg(msgType, msgData) {\n  return {\n    firebaseMessagingType: msgType,\n    firebaseMessagingData: msgData\n  };\n}\n\nfunction sleep(ms) {\n  return new Promise(function (resolve) {\n    setTimeout(resolve, ms);\n  });\n}\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nvar DEFAULT_SW_PATH = '/firebase-messaging-sw.js';\nvar DEFAULT_SW_SCOPE = '/firebase-cloud-messaging-push-scope';\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\nvar WindowController =\n/** @class */\nfunction (_super) {\n  __extends(WindowController, _super);\n  /**\r\n   * A service that provides a MessagingService instance.\r\n   */\n\n\n  function WindowController(app) {\n    var _this = _super.call(this, app) || this;\n\n    _this.registrationToUse = null;\n    _this.publicVapidKeyToUse = null;\n    _this.messageObserver = null; // @ts-ignore: Unused variable error, this is not implemented yet.\n\n    _this.tokenRefreshObserver = null;\n    _this.onMessageInternal = createSubscribe(function (observer) {\n      _this.messageObserver = observer;\n    });\n    _this.onTokenRefreshInternal = createSubscribe(function (observer) {\n      _this.tokenRefreshObserver = observer;\n    });\n\n    _this.setupSWMessageListener_();\n\n    return _this;\n  }\n  /**\r\n   * Request permission if it is not currently granted\r\n   *\r\n   * @return Resolves if the permission was granted, otherwise rejects\r\n   *\r\n   * @deprecated Use Notification.requestPermission() instead.\r\n   * https://developer.mozilla.org/en-US/docs/Web/API/Notification/requestPermission\r\n   */\n\n\n  WindowController.prototype.requestPermission = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var permissionResult;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            if (this.getNotificationPermission_() === 'granted') {\n              return [2\n              /*return*/\n              ];\n            }\n\n            return [4\n            /*yield*/\n            , Notification.requestPermission()];\n\n          case 1:\n            permissionResult = _a.sent();\n\n            if (permissionResult === 'granted') {\n              return [2\n              /*return*/\n              ];\n            } else if (permissionResult === 'denied') {\n              throw errorFactory.create(\"permission-blocked\"\n              /* PERMISSION_BLOCKED */\n              );\n            } else {\n              throw errorFactory.create(\"permission-default\"\n              /* PERMISSION_DEFAULT */\n              );\n            }\n\n        }\n      });\n    });\n  };\n  /**\r\n   * This method allows a developer to override the default service worker and\r\n   * instead use a custom service worker.\r\n   *\r\n   * @param registration The service worker registration that should be used to\r\n   * receive the push messages.\r\n   */\n\n\n  WindowController.prototype.useServiceWorker = function (registration) {\n    if (!(registration instanceof ServiceWorkerRegistration)) {\n      throw errorFactory.create(\"sw-registration-expected\"\n      /* SW_REGISTRATION_EXPECTED */\n      );\n    }\n\n    if (this.registrationToUse != null) {\n      throw errorFactory.create(\"use-sw-before-get-token\"\n      /* USE_SW_BEFORE_GET_TOKEN */\n      );\n    }\n\n    this.registrationToUse = registration;\n  };\n  /**\r\n   * This method allows a developer to override the default vapid key\r\n   * and instead use a custom VAPID public key.\r\n   *\r\n   * @param publicKey A URL safe base64 encoded string.\r\n   */\n\n\n  WindowController.prototype.usePublicVapidKey = function (publicKey) {\n    if (typeof publicKey !== 'string') {\n      throw errorFactory.create(\"invalid-public-vapid-key\"\n      /* INVALID_PUBLIC_VAPID_KEY */\n      );\n    }\n\n    if (this.publicVapidKeyToUse != null) {\n      throw errorFactory.create(\"use-public-key-before-get-token\"\n      /* USE_PUBLIC_KEY_BEFORE_GET_TOKEN */\n      );\n    }\n\n    var parsedKey = base64ToArrayBuffer(publicKey);\n\n    if (parsedKey.length !== 65) {\n      throw errorFactory.create(\"public-vapid-key-decryption-failed\"\n      /* PUBLIC_KEY_DECRYPTION_FAILED */\n      );\n    }\n\n    this.publicVapidKeyToUse = parsedKey;\n  };\n  /**\r\n   * @export\r\n   * @param nextOrObserver An observer object or a function triggered on\r\n   * message.\r\n   * @param error A function triggered on message error.\r\n   * @param completed function triggered when the observer is removed.\r\n   * @return The unsubscribe function for the observer.\r\n   */\n\n\n  WindowController.prototype.onMessage = function (nextOrObserver, error, completed) {\n    if (typeof nextOrObserver === 'function') {\n      return this.onMessageInternal(nextOrObserver, error, completed);\n    } else {\n      return this.onMessageInternal(nextOrObserver);\n    }\n  };\n  /**\r\n   * @param nextOrObserver An observer object or a function triggered on token\r\n   * refresh.\r\n   * @param error A function triggered on token refresh error.\r\n   * @param completed function triggered when the observer is removed.\r\n   * @return The unsubscribe function for the observer.\r\n   */\n\n\n  WindowController.prototype.onTokenRefresh = function (nextOrObserver, error, completed) {\n    if (typeof nextOrObserver === 'function') {\n      return this.onTokenRefreshInternal(nextOrObserver, error, completed);\n    } else {\n      return this.onTokenRefreshInternal(nextOrObserver);\n    }\n  };\n  /**\r\n   * Given a registration, wait for the service worker it relates to\r\n   * become activer\r\n   * @param registration Registration to wait for service worker to become active\r\n   * @return Wait for service worker registration to become active\r\n   */\n  // Visible for testing\n  // TODO: Make private\n\n\n  WindowController.prototype.waitForRegistrationToActivate_ = function (registration) {\n    var serviceWorker = registration.installing || registration.waiting || registration.active;\n    return new Promise(function (resolve, reject) {\n      if (!serviceWorker) {\n        // This is a rare scenario but has occured in firefox\n        reject(errorFactory.create(\"no-sw-in-reg\"\n        /* NO_SW_IN_REG */\n        ));\n        return;\n      } // Because the Promise function is called on next tick there is a\n      // small chance that the worker became active or redundant already.\n\n\n      if (serviceWorker.state === 'activated') {\n        resolve(registration);\n        return;\n      }\n\n      if (serviceWorker.state === 'redundant') {\n        reject(errorFactory.create(\"sw-reg-redundant\"\n        /* SW_REG_REDUNDANT */\n        ));\n        return;\n      }\n\n      var stateChangeListener = function stateChangeListener() {\n        if (serviceWorker.state === 'activated') {\n          resolve(registration);\n        } else if (serviceWorker.state === 'redundant') {\n          reject(errorFactory.create(\"sw-reg-redundant\"\n          /* SW_REG_REDUNDANT */\n          ));\n        } else {\n          // Return early and wait to next state change\n          return;\n        }\n\n        serviceWorker.removeEventListener('statechange', stateChangeListener);\n      };\n\n      serviceWorker.addEventListener('statechange', stateChangeListener);\n    });\n  };\n  /**\r\n   * This will register the default service worker and return the registration\r\n   * @return The service worker registration to be used for the push service.\r\n   */\n\n\n  WindowController.prototype.getSWRegistration_ = function () {\n    var _this = this;\n\n    if (this.registrationToUse) {\n      return this.waitForRegistrationToActivate_(this.registrationToUse);\n    } // Make the registration null so we know useServiceWorker will not\n    // use a new service worker as registrationToUse is no longer undefined\n\n\n    this.registrationToUse = null;\n    return navigator.serviceWorker.register(DEFAULT_SW_PATH, {\n      scope: DEFAULT_SW_SCOPE\n    })[\"catch\"](function (err) {\n      throw errorFactory.create(\"failed-serviceworker-registration\"\n      /* FAILED_DEFAULT_REGISTRATION */\n      , {\n        browserErrorMessage: err.message\n      });\n    }).then(function (registration) {\n      return _this.waitForRegistrationToActivate_(registration).then(function () {\n        _this.registrationToUse = registration; // We update after activation due to an issue with Firefox v49 where\n        // a race condition occassionally causes the service worker to not\n        // install\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n\n        registration.update();\n        return registration;\n      });\n    });\n  };\n  /**\r\n   * This will return the default VAPID key or the uint8array version of the\r\n   * public VAPID key provided by the developer.\r\n   */\n\n\n  WindowController.prototype.getPublicVapidKey_ = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        if (this.publicVapidKeyToUse) {\n          return [2\n          /*return*/\n          , this.publicVapidKeyToUse];\n        }\n\n        return [2\n        /*return*/\n        , DEFAULT_PUBLIC_VAPID_KEY];\n      });\n    });\n  };\n  /**\r\n   * This method will set up a message listener to handle\r\n   * events from the service worker that should trigger\r\n   * events in the page.\r\n   */\n  // Visible for testing\n  // TODO: Make private\n\n\n  WindowController.prototype.setupSWMessageListener_ = function () {\n    var _this = this;\n\n    navigator.serviceWorker.addEventListener('message', function (event) {\n      if (!event.data || !event.data.firebaseMessagingType || !event.data.firebaseMessagingData) {\n        // Not a message from FCM\n        return;\n      }\n\n      var _a = event.data,\n          firebaseMessagingType = _a.firebaseMessagingType,\n          firebaseMessagingData = _a.firebaseMessagingData;\n\n      if (_this.messageObserver) {\n        _this.messageObserver.next(firebaseMessagingData);\n      }\n\n      var data = firebaseMessagingData.data;\n\n      if (data && FN_CAMPAIGN_ID in data && data[FN_CAMPAIGN_ANALYTICS_ENABLED] === '1') {\n        // This message has a campaign id, meaning it was sent using the FN Console.\n        // Analytics is enabled on this message, so we should log it.\n        var eventType = getEventType(firebaseMessagingType);\n\n        _this.app.INTERNAL.analytics.logEvent(eventType,\n        /* eslint-disable camelcase */\n        {\n          message_name: data[FN_CAMPAIGN_NAME],\n          message_id: data[FN_CAMPAIGN_ID],\n          message_time: data[FN_CAMPAIGN_TIME],\n          message_device_time: Math.floor(Date.now() / 1000)\n        }\n        /* eslint-enable camelcase */\n        );\n      }\n    }, false);\n  };\n\n  return WindowController;\n}(BaseController);\n\nfunction getEventType(messageType) {\n  switch (messageType) {\n    case MessageType.NOTIFICATION_CLICKED:\n      return 'notification_open';\n\n    case MessageType.PUSH_MSG_RECEIVED:\n      return 'notification_foreground';\n\n    default:\n      throw new Error();\n  }\n}\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction registerMessaging(instance) {\n  var messagingName = 'messaging';\n\n  var factoryMethod = function factoryMethod(app) {\n    if (!isSupported()) {\n      throw errorFactory.create(\"unsupported-browser\"\n      /* UNSUPPORTED_BROWSER */\n      );\n    }\n\n    if (self && 'ServiceWorkerGlobalScope' in self) {\n      // Running in ServiceWorker context\n      return new SwController(app);\n    } else {\n      // Assume we are in the window context.\n      return new WindowController(app);\n    }\n  };\n\n  var namespaceExports = {\n    isSupported: isSupported\n  };\n  instance.INTERNAL.registerService(messagingName, factoryMethod, namespaceExports);\n}\n\nregisterMessaging(firebase);\n\nfunction isSupported() {\n  if (self && 'ServiceWorkerGlobalScope' in self) {\n    // Running in ServiceWorker context\n    return isSWControllerSupported();\n  } else {\n    // Assume we are in the window context.\n    return isWindowControllerSupported();\n  }\n}\n/**\r\n * Checks to see if the required APIs exist.\r\n */\n\n\nfunction isWindowControllerSupported() {\n  return navigator.cookieEnabled && 'serviceWorker' in navigator && 'PushManager' in window && 'Notification' in window && 'fetch' in window && ServiceWorkerRegistration.prototype.hasOwnProperty('showNotification') && PushSubscription.prototype.hasOwnProperty('getKey');\n}\n/**\r\n * Checks to see if the required APIs exist within SW Context.\r\n */\n\n\nfunction isSWControllerSupported() {\n  return 'PushManager' in self && 'Notification' in self && ServiceWorkerRegistration.prototype.hasOwnProperty('showNotification') && PushSubscription.prototype.hasOwnProperty('getKey');\n}\n\nexport { isSupported, registerMessaging };","import \"core-js/modules/es6.typed.uint8-array\";\nimport \"core-js/modules/es6.promise\";\nimport \"core-js/modules/es6.object.to-string\";\nimport \"core-js/modules/es6.regexp.replace\";\nimport \"core-js/modules/es6.number.constructor\";\nimport \"core-js/modules/es6.date.now\";\nimport \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/es7.array.includes\";\nimport \"core-js/modules/es6.string.includes\";\nimport firebase from '@firebase/app';\nimport { __values, __awaiter, __generator, __spread, __assign } from 'tslib';\nimport { ErrorFactory, FirebaseError } from '@firebase/util';\nimport { openDb } from 'idb';\nvar version = \"0.3.6\";\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\nvar PENDING_TIMEOUT_MS = 10000;\nvar PACKAGE_VERSION = \"w:\" + version;\nvar INTERNAL_AUTH_VERSION = 'FIS_v2';\nvar INSTALLATIONS_API_URL = 'https://firebaseinstallations.googleapis.com/v1';\nvar TOKEN_EXPIRATION_BUFFER = 60 * 60 * 1000; // One hour\n\nvar SERVICE = 'installations';\nvar SERVICE_NAME = 'Installations';\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\nvar _a;\n\nvar ERROR_DESCRIPTION_MAP = (_a = {}, _a[\"missing-app-config-values\"\n/* MISSING_APP_CONFIG_VALUES */\n] = 'Missing App configuration value: \"{$valueName}\"', _a[\"not-registered\"\n/* NOT_REGISTERED */\n] = 'Firebase Installation is not registered.', _a[\"installation-not-found\"\n/* INSTALLATION_NOT_FOUND */\n] = 'Firebase Installation not found.', _a[\"request-failed\"\n/* REQUEST_FAILED */\n] = '{$requestName} request failed with error \"{$serverCode} {$serverStatus}: {$serverMessage}\"', _a[\"app-offline\"\n/* APP_OFFLINE */\n] = 'Could not process request. Application offline.', _a[\"delete-pending-registration\"\n/* DELETE_PENDING_REGISTRATION */\n] = \"Can't delete installation while there is a pending registration request.\", _a);\nvar ERROR_FACTORY = new ErrorFactory(SERVICE, SERVICE_NAME, ERROR_DESCRIPTION_MAP);\n/** Returns true if error is a FirebaseError that is based on an error from the server. */\n\nfunction isServerError(error) {\n  return error instanceof FirebaseError && error.code.includes(\"request-failed\"\n  /* REQUEST_FAILED */\n  );\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction extractAppConfig(app) {\n  var e_1, _a;\n\n  if (!app || !app.options) {\n    throw getMissingValueError('App Configuration');\n  }\n\n  if (!app.name) {\n    throw getMissingValueError('App Name');\n  } // Required app config keys\n\n\n  var configKeys = ['projectId', 'apiKey', 'appId'];\n\n  try {\n    for (var configKeys_1 = __values(configKeys), configKeys_1_1 = configKeys_1.next(); !configKeys_1_1.done; configKeys_1_1 = configKeys_1.next()) {\n      var keyName = configKeys_1_1.value;\n\n      if (!app.options[keyName]) {\n        throw getMissingValueError(keyName);\n      }\n    }\n  } catch (e_1_1) {\n    e_1 = {\n      error: e_1_1\n    };\n  } finally {\n    try {\n      if (configKeys_1_1 && !configKeys_1_1.done && (_a = configKeys_1[\"return\"])) _a.call(configKeys_1);\n    } finally {\n      if (e_1) throw e_1.error;\n    }\n  }\n\n  return {\n    appName: app.name,\n    projectId: app.options.projectId,\n    apiKey: app.options.apiKey,\n    appId: app.options.appId\n  };\n}\n\nfunction getMissingValueError(valueName) {\n  return ERROR_FACTORY.create(\"missing-app-config-values\"\n  /* MISSING_APP_CONFIG_VALUES */\n  , {\n    valueName: valueName\n  });\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction getInstallationsEndpoint(_a) {\n  var projectId = _a.projectId;\n  return INSTALLATIONS_API_URL + \"/projects/\" + projectId + \"/installations\";\n}\n\nfunction extractAuthTokenInfoFromResponse(response) {\n  return {\n    token: response.token,\n    requestStatus: 2\n    /* COMPLETED */\n    ,\n    expiresIn: getExpiresInFromResponseExpiresIn(response.expiresIn),\n    creationTime: Date.now()\n  };\n}\n\nfunction getErrorFromResponse(requestName, response) {\n  return __awaiter(this, void 0, void 0, function () {\n    var responseJson, errorData;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , response.json()];\n\n        case 1:\n          responseJson = _a.sent();\n          errorData = responseJson.error;\n          return [2\n          /*return*/\n          , ERROR_FACTORY.create(\"request-failed\"\n          /* REQUEST_FAILED */\n          , {\n            requestName: requestName,\n            serverCode: errorData.code,\n            serverMessage: errorData.message,\n            serverStatus: errorData.status\n          })];\n      }\n    });\n  });\n}\n\nfunction getHeaders(_a) {\n  var apiKey = _a.apiKey;\n  return new Headers({\n    'Content-Type': 'application/json',\n    Accept: 'application/json',\n    'x-goog-api-key': apiKey\n  });\n}\n\nfunction getHeadersWithAuth(appConfig, _a) {\n  var refreshToken = _a.refreshToken;\n  var headers = getHeaders(appConfig);\n  headers.append('Authorization', getAuthorizationHeader(refreshToken));\n  return headers;\n}\n/**\r\n * Calls the passed in fetch wrapper and returns the response.\r\n * If the returned response has a status of 5xx, re-runs the function once and\r\n * returns the response.\r\n */\n\n\nfunction retryIfServerError(fn) {\n  return __awaiter(this, void 0, void 0, function () {\n    var result;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , fn()];\n\n        case 1:\n          result = _a.sent();\n\n          if (result.status >= 500 && result.status < 600) {\n            // Internal Server Error. Retry request.\n            return [2\n            /*return*/\n            , fn()];\n          }\n\n          return [2\n          /*return*/\n          , result];\n      }\n    });\n  });\n}\n\nfunction getExpiresInFromResponseExpiresIn(responseExpiresIn) {\n  // This works because the server will never respond with fractions of a second.\n  return Number(responseExpiresIn.replace('s', '000'));\n}\n\nfunction getAuthorizationHeader(refreshToken) {\n  return INTERNAL_AUTH_VERSION + \" \" + refreshToken;\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction createInstallation(appConfig, _a) {\n  var fid = _a.fid;\n  return __awaiter(this, void 0, void 0, function () {\n    var endpoint, headers, body, request, response, responseValue, registeredInstallationEntry;\n    return __generator(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          endpoint = getInstallationsEndpoint(appConfig);\n          headers = getHeaders(appConfig);\n          body = {\n            fid: fid,\n            authVersion: INTERNAL_AUTH_VERSION,\n            appId: appConfig.appId,\n            sdkVersion: PACKAGE_VERSION\n          };\n          request = {\n            method: 'POST',\n            headers: headers,\n            body: JSON.stringify(body)\n          };\n          return [4\n          /*yield*/\n          , retryIfServerError(function () {\n            return fetch(endpoint, request);\n          })];\n\n        case 1:\n          response = _b.sent();\n          if (!response.ok) return [3\n          /*break*/\n          , 3];\n          return [4\n          /*yield*/\n          , response.json()];\n\n        case 2:\n          responseValue = _b.sent();\n          registeredInstallationEntry = {\n            fid: responseValue.fid || fid,\n            registrationStatus: 2\n            /* COMPLETED */\n            ,\n            refreshToken: responseValue.refreshToken,\n            authToken: extractAuthTokenInfoFromResponse(responseValue.authToken)\n          };\n          return [2\n          /*return*/\n          , registeredInstallationEntry];\n\n        case 3:\n          return [4\n          /*yield*/\n          , getErrorFromResponse('Create Installation', response)];\n\n        case 4:\n          throw _b.sent();\n      }\n    });\n  });\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n/** Returns a promise that resolves after given time passes. */\n\n\nfunction sleep(ms) {\n  return new Promise(function (resolve) {\n    setTimeout(resolve, ms);\n  });\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction bufferToBase64UrlSafe(array) {\n  var b64 = btoa(String.fromCharCode.apply(String, __spread(array)));\n  return b64.replace(/\\+/g, '-').replace(/\\//g, '_');\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nvar VALID_FID_PATTERN = /^[cdef][\\w-]{21}$/;\nvar INVALID_FID = '';\n/**\r\n * Generates a new FID using random values from Web Crypto API.\r\n * Returns an empty string if FID generation fails for any reason.\r\n */\n\nfunction generateFid() {\n  try {\n    // A valid FID has exactly 22 base64 characters, which is 132 bits, or 16.5\n    // bytes. our implementation generates a 17 byte array instead.\n    var fidByteArray = new Uint8Array(17);\n    var crypto_1 = self.crypto || self.msCrypto;\n    crypto_1.getRandomValues(fidByteArray); // Replace the first 4 random bits with the constant FID header of 0b0111.\n\n    fidByteArray[0] = 112 + fidByteArray[0] % 16;\n    var fid = encode(fidByteArray);\n    return VALID_FID_PATTERN.test(fid) ? fid : INVALID_FID;\n  } catch (_a) {\n    // FID generation errored\n    return INVALID_FID;\n  }\n}\n/** Converts a FID Uint8Array to a base64 string representation. */\n\n\nfunction encode(fidByteArray) {\n  var b64String = bufferToBase64UrlSafe(fidByteArray); // Remove the 23rd character that was added because of the extra 4 bits at the\n  // end of our 17 byte array, and the '=' padding.\n\n  return b64String.substr(0, 22);\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nvar DATABASE_NAME = 'firebase-installations-database';\nvar DATABASE_VERSION = 1;\nvar OBJECT_STORE_NAME = 'firebase-installations-store';\nvar dbPromise = null;\n\nfunction getDbPromise() {\n  if (!dbPromise) {\n    dbPromise = openDb(DATABASE_NAME, DATABASE_VERSION, function (upgradeDB) {\n      // We don't use 'break' in this switch statement, the fall-through\n      // behavior is what we want, because if there are multiple versions between\n      // the old version and the current version, we want ALL the migrations\n      // that correspond to those versions to run, not only the last one.\n      // eslint-disable-next-line default-case\n      switch (upgradeDB.oldVersion) {\n        case 0:\n          upgradeDB.createObjectStore(OBJECT_STORE_NAME);\n      }\n    });\n  }\n\n  return dbPromise;\n}\n/** Assigns or overwrites the record for the given key with the given value. */\n\n\nfunction set(appConfig, value) {\n  return __awaiter(this, void 0, void 0, function () {\n    var key, db, tx;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          key = getKey(appConfig);\n          return [4\n          /*yield*/\n          , getDbPromise()];\n\n        case 1:\n          db = _a.sent();\n          tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\n          return [4\n          /*yield*/\n          , tx.objectStore(OBJECT_STORE_NAME).put(value, key)];\n\n        case 2:\n          _a.sent();\n\n          return [4\n          /*yield*/\n          , tx.complete];\n\n        case 3:\n          _a.sent();\n\n          return [2\n          /*return*/\n          , value];\n      }\n    });\n  });\n}\n/** Removes record(s) from the objectStore that match the given key. */\n\n\nfunction remove(appConfig) {\n  return __awaiter(this, void 0, void 0, function () {\n    var key, db, tx;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          key = getKey(appConfig);\n          return [4\n          /*yield*/\n          , getDbPromise()];\n\n        case 1:\n          db = _a.sent();\n          tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\n          return [4\n          /*yield*/\n          , tx.objectStore(OBJECT_STORE_NAME)[\"delete\"](key)];\n\n        case 2:\n          _a.sent();\n\n          return [4\n          /*yield*/\n          , tx.complete];\n\n        case 3:\n          _a.sent();\n\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n}\n/**\r\n * Atomically updates a record with the result of updateFn, which gets\r\n * called with the current value. If newValue is undefined, the record is\r\n * deleted instead.\r\n * @return Updated value\r\n */\n\n\nfunction update(appConfig, updateFn) {\n  return __awaiter(this, void 0, void 0, function () {\n    var key, db, tx, store, oldValue, newValue;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          key = getKey(appConfig);\n          return [4\n          /*yield*/\n          , getDbPromise()];\n\n        case 1:\n          db = _a.sent();\n          tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\n          store = tx.objectStore(OBJECT_STORE_NAME);\n          return [4\n          /*yield*/\n          , store.get(key)];\n\n        case 2:\n          oldValue = _a.sent();\n          newValue = updateFn(oldValue);\n          if (!(newValue === undefined)) return [3\n          /*break*/\n          , 4];\n          return [4\n          /*yield*/\n          , store[\"delete\"](key)];\n\n        case 3:\n          _a.sent();\n\n          return [3\n          /*break*/\n          , 6];\n\n        case 4:\n          return [4\n          /*yield*/\n          , store.put(newValue, key)];\n\n        case 5:\n          _a.sent();\n\n          _a.label = 6;\n\n        case 6:\n          return [4\n          /*yield*/\n          , tx.complete];\n\n        case 7:\n          _a.sent();\n\n          return [2\n          /*return*/\n          , newValue];\n      }\n    });\n  });\n}\n\nfunction getKey(appConfig) {\n  return appConfig.appName + \"!\" + appConfig.appId;\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n/**\r\n * Updates and returns the InstallationEntry from the database.\r\n * Also triggers a registration request if it is necessary and possible.\r\n */\n\n\nfunction getInstallationEntry(appConfig) {\n  return __awaiter(this, void 0, void 0, function () {\n    var registrationPromise, installationEntry, _a;\n\n    return __generator(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , update(appConfig, function (oldEntry) {\n            var installationEntry = updateOrCreateInstallationEntry(oldEntry);\n            var entryWithPromise = triggerRegistrationIfNecessary(appConfig, installationEntry);\n            registrationPromise = entryWithPromise.registrationPromise;\n            return entryWithPromise.installationEntry;\n          })];\n\n        case 1:\n          installationEntry = _b.sent();\n          if (!(installationEntry.fid === INVALID_FID)) return [3\n          /*break*/\n          , 3];\n          _a = {};\n          return [4\n          /*yield*/\n          , registrationPromise];\n\n        case 2:\n          // FID generation failed. Waiting for the FID from the server.\n          return [2\n          /*return*/\n          , (_a.installationEntry = _b.sent(), _a)];\n\n        case 3:\n          return [2\n          /*return*/\n          , {\n            installationEntry: installationEntry,\n            registrationPromise: registrationPromise\n          }];\n      }\n    });\n  });\n}\n/**\r\n * Creates a new Installation Entry if one does not exist.\r\n * Also clears timed out pending requests.\r\n */\n\n\nfunction updateOrCreateInstallationEntry(oldEntry) {\n  var entry = oldEntry || {\n    fid: generateFid(),\n    registrationStatus: 0\n    /* NOT_STARTED */\n\n  };\n  return clearTimedOutRequest(entry);\n}\n/**\r\n * If the Firebase Installation is not registered yet, this will trigger the\r\n * registration and return an InProgressInstallationEntry.\r\n *\r\n * If registrationPromise does not exist, the installationEntry is guaranteed\r\n * to be registered.\r\n */\n\n\nfunction triggerRegistrationIfNecessary(appConfig, installationEntry) {\n  if (installationEntry.registrationStatus === 0\n  /* NOT_STARTED */\n  ) {\n      if (!navigator.onLine) {\n        // Registration required but app is offline.\n        var registrationPromiseWithError = Promise.reject(ERROR_FACTORY.create(\"app-offline\"\n        /* APP_OFFLINE */\n        ));\n        return {\n          installationEntry: installationEntry,\n          registrationPromise: registrationPromiseWithError\n        };\n      } // Try registering. Change status to IN_PROGRESS.\n\n\n      var inProgressEntry = {\n        fid: installationEntry.fid,\n        registrationStatus: 1\n        /* IN_PROGRESS */\n        ,\n        registrationTime: Date.now()\n      };\n      var registrationPromise = registerInstallation(appConfig, inProgressEntry);\n      return {\n        installationEntry: inProgressEntry,\n        registrationPromise: registrationPromise\n      };\n    } else if (installationEntry.registrationStatus === 1\n  /* IN_PROGRESS */\n  ) {\n      return {\n        installationEntry: installationEntry,\n        registrationPromise: waitUntilFidRegistration(appConfig)\n      };\n    } else {\n    return {\n      installationEntry: installationEntry\n    };\n  }\n}\n/** This will be executed only once for each new Firebase Installation. */\n\n\nfunction registerInstallation(appConfig, installationEntry) {\n  return __awaiter(this, void 0, void 0, function () {\n    var registeredInstallationEntry, e_1;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          _a.trys.push([0, 2,, 7]);\n\n          return [4\n          /*yield*/\n          , createInstallation(appConfig, installationEntry)];\n\n        case 1:\n          registeredInstallationEntry = _a.sent();\n          return [2\n          /*return*/\n          , set(appConfig, registeredInstallationEntry)];\n\n        case 2:\n          e_1 = _a.sent();\n          if (!(isServerError(e_1) && e_1.serverCode === 409)) return [3\n          /*break*/\n          , 4]; // Server returned a \"FID can not be used\" error.\n          // Generate a new ID next time.\n\n          return [4\n          /*yield*/\n          , remove(appConfig)];\n\n        case 3:\n          // Server returned a \"FID can not be used\" error.\n          // Generate a new ID next time.\n          _a.sent();\n\n          return [3\n          /*break*/\n          , 6];\n\n        case 4:\n          // Registration failed. Set FID as not registered.\n          return [4\n          /*yield*/\n          , set(appConfig, {\n            fid: installationEntry.fid,\n            registrationStatus: 0\n            /* NOT_STARTED */\n\n          })];\n\n        case 5:\n          // Registration failed. Set FID as not registered.\n          _a.sent();\n\n          _a.label = 6;\n\n        case 6:\n          throw e_1;\n\n        case 7:\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n}\n/** Call if FID registration is pending in another request. */\n\n\nfunction waitUntilFidRegistration(appConfig) {\n  return __awaiter(this, void 0, void 0, function () {\n    var entry, _a, installationEntry, registrationPromise;\n\n    return __generator(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , updateInstallationRequest(appConfig)];\n\n        case 1:\n          entry = _b.sent();\n          _b.label = 2;\n\n        case 2:\n          if (!(entry.registrationStatus === 1\n          /* IN_PROGRESS */\n          )) return [3\n            /*break*/\n            , 5]; // createInstallation request still in progress.\n\n          return [4\n          /*yield*/\n          , sleep(100)];\n\n        case 3:\n          // createInstallation request still in progress.\n          _b.sent();\n\n          return [4\n          /*yield*/\n          , updateInstallationRequest(appConfig)];\n\n        case 4:\n          entry = _b.sent();\n          return [3\n          /*break*/\n          , 2];\n\n        case 5:\n          if (!(entry.registrationStatus === 0\n          /* NOT_STARTED */\n          )) return [3\n            /*break*/\n            , 7];\n          return [4\n          /*yield*/\n          , getInstallationEntry(appConfig)];\n\n        case 6:\n          _a = _b.sent(), installationEntry = _a.installationEntry, registrationPromise = _a.registrationPromise;\n\n          if (registrationPromise) {\n            return [2\n            /*return*/\n            , registrationPromise];\n          } else {\n            // if there is no registrationPromise, entry is registered.\n            return [2\n            /*return*/\n            , installationEntry];\n          }\n\n        case 7:\n          return [2\n          /*return*/\n          , entry];\n      }\n    });\n  });\n}\n/**\r\n * Called only if there is a CreateInstallation request in progress.\r\n *\r\n * Updates the InstallationEntry in the DB based on the status of the\r\n * CreateInstallation request.\r\n *\r\n * Returns the updated InstallationEntry.\r\n */\n\n\nfunction updateInstallationRequest(appConfig) {\n  return update(appConfig, function (oldEntry) {\n    if (!oldEntry) {\n      throw ERROR_FACTORY.create(\"installation-not-found\"\n      /* INSTALLATION_NOT_FOUND */\n      );\n    }\n\n    return clearTimedOutRequest(oldEntry);\n  });\n}\n\nfunction clearTimedOutRequest(entry) {\n  if (hasInstallationRequestTimedOut(entry)) {\n    return {\n      fid: entry.fid,\n      registrationStatus: 0\n      /* NOT_STARTED */\n\n    };\n  }\n\n  return entry;\n}\n\nfunction hasInstallationRequestTimedOut(installationEntry) {\n  return installationEntry.registrationStatus === 1\n  /* IN_PROGRESS */\n  && installationEntry.registrationTime + PENDING_TIMEOUT_MS < Date.now();\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction generateAuthToken(appConfig, installationEntry) {\n  return __awaiter(this, void 0, void 0, function () {\n    var endpoint, headers, body, request, response, responseValue, completedAuthToken;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          endpoint = getGenerateAuthTokenEndpoint(appConfig, installationEntry);\n          headers = getHeadersWithAuth(appConfig, installationEntry);\n          body = {\n            installation: {\n              sdkVersion: PACKAGE_VERSION\n            }\n          };\n          request = {\n            method: 'POST',\n            headers: headers,\n            body: JSON.stringify(body)\n          };\n          return [4\n          /*yield*/\n          , retryIfServerError(function () {\n            return fetch(endpoint, request);\n          })];\n\n        case 1:\n          response = _a.sent();\n          if (!response.ok) return [3\n          /*break*/\n          , 3];\n          return [4\n          /*yield*/\n          , response.json()];\n\n        case 2:\n          responseValue = _a.sent();\n          completedAuthToken = extractAuthTokenInfoFromResponse(responseValue);\n          return [2\n          /*return*/\n          , completedAuthToken];\n\n        case 3:\n          return [4\n          /*yield*/\n          , getErrorFromResponse('Generate Auth Token', response)];\n\n        case 4:\n          throw _a.sent();\n      }\n    });\n  });\n}\n\nfunction getGenerateAuthTokenEndpoint(appConfig, _a) {\n  var fid = _a.fid;\n  return getInstallationsEndpoint(appConfig) + \"/\" + fid + \"/authTokens:generate\";\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n/**\r\n * Returns a valid authentication token for the installation. Generates a new\r\n * token if one doesn't exist, is expired or about to expire.\r\n *\r\n * Should only be called if the Firebase Installation is registered.\r\n */\n\n\nfunction refreshAuthToken(appConfig, forceRefresh) {\n  if (forceRefresh === void 0) {\n    forceRefresh = false;\n  }\n\n  return __awaiter(this, void 0, void 0, function () {\n    var tokenPromise, entry, authToken, _a;\n\n    return __generator(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , update(appConfig, function (oldEntry) {\n            if (!isEntryRegistered(oldEntry)) {\n              throw ERROR_FACTORY.create(\"not-registered\"\n              /* NOT_REGISTERED */\n              );\n            }\n\n            var oldAuthToken = oldEntry.authToken;\n\n            if (!forceRefresh && isAuthTokenValid(oldAuthToken)) {\n              // There is a valid token in the DB.\n              return oldEntry;\n            } else if (oldAuthToken.requestStatus === 1\n            /* IN_PROGRESS */\n            ) {\n                // There already is a token request in progress.\n                tokenPromise = waitUntilAuthTokenRequest(appConfig, forceRefresh);\n                return oldEntry;\n              } else {\n              // No token or token expired.\n              if (!navigator.onLine) {\n                throw ERROR_FACTORY.create(\"app-offline\"\n                /* APP_OFFLINE */\n                );\n              }\n\n              var inProgressEntry = makeAuthTokenRequestInProgressEntry(oldEntry);\n              tokenPromise = fetchAuthTokenFromServer(appConfig, inProgressEntry);\n              return inProgressEntry;\n            }\n          })];\n\n        case 1:\n          entry = _b.sent();\n          if (!tokenPromise) return [3\n          /*break*/\n          , 3];\n          return [4\n          /*yield*/\n          , tokenPromise];\n\n        case 2:\n          _a = _b.sent();\n          return [3\n          /*break*/\n          , 4];\n\n        case 3:\n          _a = entry.authToken;\n          _b.label = 4;\n\n        case 4:\n          authToken = _a;\n          return [2\n          /*return*/\n          , authToken];\n      }\n    });\n  });\n}\n/**\r\n * Call only if FID is registered and Auth Token request is in progress.\r\n */\n\n\nfunction waitUntilAuthTokenRequest(appConfig, forceRefresh) {\n  return __awaiter(this, void 0, void 0, function () {\n    var entry, authToken;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , updateAuthTokenRequest(appConfig)];\n\n        case 1:\n          entry = _a.sent();\n          _a.label = 2;\n\n        case 2:\n          if (!(entry.authToken.requestStatus === 1\n          /* IN_PROGRESS */\n          )) return [3\n            /*break*/\n            , 5]; // generateAuthToken still in progress.\n\n          return [4\n          /*yield*/\n          , sleep(100)];\n\n        case 3:\n          // generateAuthToken still in progress.\n          _a.sent();\n\n          return [4\n          /*yield*/\n          , updateAuthTokenRequest(appConfig)];\n\n        case 4:\n          entry = _a.sent();\n          return [3\n          /*break*/\n          , 2];\n\n        case 5:\n          authToken = entry.authToken;\n\n          if (authToken.requestStatus === 0\n          /* NOT_STARTED */\n          ) {\n              // The request timed out or failed in a different call. Try again.\n              return [2\n              /*return*/\n              , refreshAuthToken(appConfig, forceRefresh)];\n            } else {\n            return [2\n            /*return*/\n            , authToken];\n          }\n\n      }\n    });\n  });\n}\n/**\r\n * Called only if there is a GenerateAuthToken request in progress.\r\n *\r\n * Updates the InstallationEntry in the DB based on the status of the\r\n * GenerateAuthToken request.\r\n *\r\n * Returns the updated InstallationEntry.\r\n */\n\n\nfunction updateAuthTokenRequest(appConfig) {\n  return update(appConfig, function (oldEntry) {\n    if (!isEntryRegistered(oldEntry)) {\n      throw ERROR_FACTORY.create(\"not-registered\"\n      /* NOT_REGISTERED */\n      );\n    }\n\n    var oldAuthToken = oldEntry.authToken;\n\n    if (hasAuthTokenRequestTimedOut(oldAuthToken)) {\n      return __assign(__assign({}, oldEntry), {\n        authToken: {\n          requestStatus: 0\n          /* NOT_STARTED */\n\n        }\n      });\n    }\n\n    return oldEntry;\n  });\n}\n\nfunction fetchAuthTokenFromServer(appConfig, installationEntry) {\n  return __awaiter(this, void 0, void 0, function () {\n    var authToken, updatedInstallationEntry, e_1, updatedInstallationEntry;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          _a.trys.push([0, 3,, 8]);\n\n          return [4\n          /*yield*/\n          , generateAuthToken(appConfig, installationEntry)];\n\n        case 1:\n          authToken = _a.sent();\n          updatedInstallationEntry = __assign(__assign({}, installationEntry), {\n            authToken: authToken\n          });\n          return [4\n          /*yield*/\n          , set(appConfig, updatedInstallationEntry)];\n\n        case 2:\n          _a.sent();\n\n          return [2\n          /*return*/\n          , authToken];\n\n        case 3:\n          e_1 = _a.sent();\n          if (!(isServerError(e_1) && (e_1.serverCode === 401 || e_1.serverCode === 404))) return [3\n          /*break*/\n          , 5]; // Server returned a \"FID not found\" or a \"Invalid authentication\" error.\n          // Generate a new ID next time.\n\n          return [4\n          /*yield*/\n          , remove(appConfig)];\n\n        case 4:\n          // Server returned a \"FID not found\" or a \"Invalid authentication\" error.\n          // Generate a new ID next time.\n          _a.sent();\n\n          return [3\n          /*break*/\n          , 7];\n\n        case 5:\n          updatedInstallationEntry = __assign(__assign({}, installationEntry), {\n            authToken: {\n              requestStatus: 0\n              /* NOT_STARTED */\n\n            }\n          });\n          return [4\n          /*yield*/\n          , set(appConfig, updatedInstallationEntry)];\n\n        case 6:\n          _a.sent();\n\n          _a.label = 7;\n\n        case 7:\n          throw e_1;\n\n        case 8:\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n}\n\nfunction isEntryRegistered(installationEntry) {\n  return installationEntry !== undefined && installationEntry.registrationStatus === 2\n  /* COMPLETED */\n  ;\n}\n\nfunction isAuthTokenValid(authToken) {\n  return authToken.requestStatus === 2\n  /* COMPLETED */\n  && !isAuthTokenExpired(authToken);\n}\n\nfunction isAuthTokenExpired(authToken) {\n  var now = Date.now();\n  return now < authToken.creationTime || authToken.creationTime + authToken.expiresIn < now + TOKEN_EXPIRATION_BUFFER;\n}\n/** Returns an updated InstallationEntry with an InProgressAuthToken. */\n\n\nfunction makeAuthTokenRequestInProgressEntry(oldEntry) {\n  var inProgressAuthToken = {\n    requestStatus: 1\n    /* IN_PROGRESS */\n    ,\n    requestTime: Date.now()\n  };\n  return __assign(__assign({}, oldEntry), {\n    authToken: inProgressAuthToken\n  });\n}\n\nfunction hasAuthTokenRequestTimedOut(authToken) {\n  return authToken.requestStatus === 1\n  /* IN_PROGRESS */\n  && authToken.requestTime + PENDING_TIMEOUT_MS < Date.now();\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction _getId(app) {\n  return __awaiter(this, void 0, void 0, function () {\n    var appConfig, _a, installationEntry, registrationPromise;\n\n    return __generator(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          appConfig = extractAppConfig(app);\n          return [4\n          /*yield*/\n          , getInstallationEntry(appConfig)];\n\n        case 1:\n          _a = _b.sent(), installationEntry = _a.installationEntry, registrationPromise = _a.registrationPromise;\n\n          if (registrationPromise) {\n            registrationPromise[\"catch\"](console.error);\n          } else {\n            // If the installation is already registered, update the authentication\n            // token if needed.\n            refreshAuthToken(appConfig)[\"catch\"](console.error);\n          }\n\n          return [2\n          /*return*/\n          , installationEntry.fid];\n      }\n    });\n  });\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction _getToken(app, forceRefresh) {\n  if (forceRefresh === void 0) {\n    forceRefresh = false;\n  }\n\n  return __awaiter(this, void 0, void 0, function () {\n    var appConfig, authToken;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          appConfig = extractAppConfig(app);\n          return [4\n          /*yield*/\n          , completeInstallationRegistration(appConfig)];\n\n        case 1:\n          _a.sent();\n\n          return [4\n          /*yield*/\n          , refreshAuthToken(appConfig, forceRefresh)];\n\n        case 2:\n          authToken = _a.sent();\n          return [2\n          /*return*/\n          , authToken.token];\n      }\n    });\n  });\n}\n\nfunction completeInstallationRegistration(appConfig) {\n  return __awaiter(this, void 0, void 0, function () {\n    var registrationPromise;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , getInstallationEntry(appConfig)];\n\n        case 1:\n          registrationPromise = _a.sent().registrationPromise;\n          if (!registrationPromise) return [3\n          /*break*/\n          , 3]; // A createInstallation request is in progress. Wait until it finishes.\n\n          return [4\n          /*yield*/\n          , registrationPromise];\n\n        case 2:\n          // A createInstallation request is in progress. Wait until it finishes.\n          _a.sent();\n\n          _a.label = 3;\n\n        case 3:\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction deleteInstallation(appConfig, installationEntry) {\n  return __awaiter(this, void 0, void 0, function () {\n    var endpoint, headers, request, response;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          endpoint = getDeleteEndpoint(appConfig, installationEntry);\n          headers = getHeadersWithAuth(appConfig, installationEntry);\n          request = {\n            method: 'DELETE',\n            headers: headers\n          };\n          return [4\n          /*yield*/\n          , retryIfServerError(function () {\n            return fetch(endpoint, request);\n          })];\n\n        case 1:\n          response = _a.sent();\n          if (!!response.ok) return [3\n          /*break*/\n          , 3];\n          return [4\n          /*yield*/\n          , getErrorFromResponse('Delete Installation', response)];\n\n        case 2:\n          throw _a.sent();\n\n        case 3:\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n}\n\nfunction getDeleteEndpoint(appConfig, _a) {\n  var fid = _a.fid;\n  return getInstallationsEndpoint(appConfig) + \"/\" + fid;\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction deleteInstallation$1(app) {\n  return __awaiter(this, void 0, void 0, function () {\n    var appConfig, entry;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          appConfig = extractAppConfig(app);\n          return [4\n          /*yield*/\n          , update(appConfig, function (oldEntry) {\n            if (oldEntry && oldEntry.registrationStatus === 0\n            /* NOT_STARTED */\n            ) {\n                // Delete the unregistered entry without sending a deleteInstallation request.\n                return undefined;\n              }\n\n            return oldEntry;\n          })];\n\n        case 1:\n          entry = _a.sent();\n          if (!entry) return [3\n          /*break*/\n          , 6];\n          if (!(entry.registrationStatus === 1\n          /* IN_PROGRESS */\n          )) return [3\n            /*break*/\n            , 2]; // Can't delete while trying to register.\n\n          throw ERROR_FACTORY.create(\"delete-pending-registration\"\n          /* DELETE_PENDING_REGISTRATION */\n          );\n\n        case 2:\n          if (!(entry.registrationStatus === 2\n          /* COMPLETED */\n          )) return [3\n            /*break*/\n            , 6];\n          if (!!navigator.onLine) return [3\n          /*break*/\n          , 3];\n          throw ERROR_FACTORY.create(\"app-offline\"\n          /* APP_OFFLINE */\n          );\n\n        case 3:\n          return [4\n          /*yield*/\n          , deleteInstallation(appConfig, entry)];\n\n        case 4:\n          _a.sent();\n\n          return [4\n          /*yield*/\n          , remove(appConfig)];\n\n        case 5:\n          _a.sent();\n\n          _a.label = 6;\n\n        case 6:\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction registerInstallations(instance) {\n  var installationsName = 'installations';\n\n  var factoryMethod = function factoryMethod(app) {\n    // Throws if app isn't configured properly.\n    extractAppConfig(app);\n    return {\n      app: app,\n      getId: function getId() {\n        return _getId(app);\n      },\n      getToken: function getToken(forceRefresh) {\n        return _getToken(app, forceRefresh);\n      },\n      \"delete\": function _delete() {\n        return deleteInstallation$1(app);\n      }\n    };\n  };\n\n  instance.INTERNAL.registerService(installationsName, factoryMethod);\n}\n\nregisterInstallations(firebase);\nexport { registerInstallations };","'use strict';\nvar toInteger = require('./_to-integer');\nvar defined = require('./_defined');\n\nmodule.exports = function repeat(count) {\n  var str = String(defined(this));\n  var res = '';\n  var n = toInteger(count);\n  if (n < 0 || n == Infinity) throw RangeError(\"Count can't be negative\");\n  for (;n > 0; (n >>>= 1) && (str += str)) if (n & 1) res += str;\n  return res;\n};\n","require(\"core-js/modules/es6.regexp.replace\");\n\nrequire(\"core-js/modules/es6.object.define-property\");\n\nrequire(\"core-js/modules/es6.array.for-each\");\n\nrequire(\"core-js/modules/es6.promise\");\n\nrequire(\"core-js/modules/es6.object.to-string\");\n\n(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) : typeof define === 'function' && define.amd ? define(['exports'], factory) : (global = global || self, factory(global.idb = {}));\n})(this, function (exports) {\n  'use strict';\n\n  function toArray(arr) {\n    return Array.prototype.slice.call(arr);\n  }\n\n  function promisifyRequest(request) {\n    return new Promise(function (resolve, reject) {\n      request.onsuccess = function () {\n        resolve(request.result);\n      };\n\n      request.onerror = function () {\n        reject(request.error);\n      };\n    });\n  }\n\n  function promisifyRequestCall(obj, method, args) {\n    var request;\n    var p = new Promise(function (resolve, reject) {\n      request = obj[method].apply(obj, args);\n      promisifyRequest(request).then(resolve, reject);\n    });\n    p.request = request;\n    return p;\n  }\n\n  function promisifyCursorRequestCall(obj, method, args) {\n    var p = promisifyRequestCall(obj, method, args);\n    return p.then(function (value) {\n      if (!value) return;\n      return new Cursor(value, p.request);\n    });\n  }\n\n  function proxyProperties(ProxyClass, targetProp, properties) {\n    properties.forEach(function (prop) {\n      Object.defineProperty(ProxyClass.prototype, prop, {\n        get: function get() {\n          return this[targetProp][prop];\n        },\n        set: function set(val) {\n          this[targetProp][prop] = val;\n        }\n      });\n    });\n  }\n\n  function proxyRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function (prop) {\n      if (!(prop in Constructor.prototype)) return;\n\n      ProxyClass.prototype[prop] = function () {\n        return promisifyRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function proxyMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function (prop) {\n      if (!(prop in Constructor.prototype)) return;\n\n      ProxyClass.prototype[prop] = function () {\n        return this[targetProp][prop].apply(this[targetProp], arguments);\n      };\n    });\n  }\n\n  function proxyCursorRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function (prop) {\n      if (!(prop in Constructor.prototype)) return;\n\n      ProxyClass.prototype[prop] = function () {\n        return promisifyCursorRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function Index(index) {\n    this._index = index;\n  }\n\n  proxyProperties(Index, '_index', ['name', 'keyPath', 'multiEntry', 'unique']);\n  proxyRequestMethods(Index, '_index', IDBIndex, ['get', 'getKey', 'getAll', 'getAllKeys', 'count']);\n  proxyCursorRequestMethods(Index, '_index', IDBIndex, ['openCursor', 'openKeyCursor']);\n\n  function Cursor(cursor, request) {\n    this._cursor = cursor;\n    this._request = request;\n  }\n\n  proxyProperties(Cursor, '_cursor', ['direction', 'key', 'primaryKey', 'value']);\n  proxyRequestMethods(Cursor, '_cursor', IDBCursor, ['update', 'delete']); // proxy 'next' methods\n\n  ['advance', 'continue', 'continuePrimaryKey'].forEach(function (methodName) {\n    if (!(methodName in IDBCursor.prototype)) return;\n\n    Cursor.prototype[methodName] = function () {\n      var cursor = this;\n      var args = arguments;\n      return Promise.resolve().then(function () {\n        cursor._cursor[methodName].apply(cursor._cursor, args);\n\n        return promisifyRequest(cursor._request).then(function (value) {\n          if (!value) return;\n          return new Cursor(value, cursor._request);\n        });\n      });\n    };\n  });\n\n  function ObjectStore(store) {\n    this._store = store;\n  }\n\n  ObjectStore.prototype.createIndex = function () {\n    return new Index(this._store.createIndex.apply(this._store, arguments));\n  };\n\n  ObjectStore.prototype.index = function () {\n    return new Index(this._store.index.apply(this._store, arguments));\n  };\n\n  proxyProperties(ObjectStore, '_store', ['name', 'keyPath', 'indexNames', 'autoIncrement']);\n  proxyRequestMethods(ObjectStore, '_store', IDBObjectStore, ['put', 'add', 'delete', 'clear', 'get', 'getAll', 'getKey', 'getAllKeys', 'count']);\n  proxyCursorRequestMethods(ObjectStore, '_store', IDBObjectStore, ['openCursor', 'openKeyCursor']);\n  proxyMethods(ObjectStore, '_store', IDBObjectStore, ['deleteIndex']);\n\n  function Transaction(idbTransaction) {\n    this._tx = idbTransaction;\n    this.complete = new Promise(function (resolve, reject) {\n      idbTransaction.oncomplete = function () {\n        resolve();\n      };\n\n      idbTransaction.onerror = function () {\n        reject(idbTransaction.error);\n      };\n\n      idbTransaction.onabort = function () {\n        reject(idbTransaction.error);\n      };\n    });\n  }\n\n  Transaction.prototype.objectStore = function () {\n    return new ObjectStore(this._tx.objectStore.apply(this._tx, arguments));\n  };\n\n  proxyProperties(Transaction, '_tx', ['objectStoreNames', 'mode']);\n  proxyMethods(Transaction, '_tx', IDBTransaction, ['abort']);\n\n  function UpgradeDB(db, oldVersion, transaction) {\n    this._db = db;\n    this.oldVersion = oldVersion;\n    this.transaction = new Transaction(transaction);\n  }\n\n  UpgradeDB.prototype.createObjectStore = function () {\n    return new ObjectStore(this._db.createObjectStore.apply(this._db, arguments));\n  };\n\n  proxyProperties(UpgradeDB, '_db', ['name', 'version', 'objectStoreNames']);\n  proxyMethods(UpgradeDB, '_db', IDBDatabase, ['deleteObjectStore', 'close']);\n\n  function DB(db) {\n    this._db = db;\n  }\n\n  DB.prototype.transaction = function () {\n    return new Transaction(this._db.transaction.apply(this._db, arguments));\n  };\n\n  proxyProperties(DB, '_db', ['name', 'version', 'objectStoreNames']);\n  proxyMethods(DB, '_db', IDBDatabase, ['close']); // Add cursor iterators\n  // TODO: remove this once browsers do the right thing with promises\n\n  ['openCursor', 'openKeyCursor'].forEach(function (funcName) {\n    [ObjectStore, Index].forEach(function (Constructor) {\n      // Don't create iterateKeyCursor if openKeyCursor doesn't exist.\n      if (!(funcName in Constructor.prototype)) return;\n\n      Constructor.prototype[funcName.replace('open', 'iterate')] = function () {\n        var args = toArray(arguments);\n        var callback = args[args.length - 1];\n        var nativeObject = this._store || this._index;\n        var request = nativeObject[funcName].apply(nativeObject, args.slice(0, -1));\n\n        request.onsuccess = function () {\n          callback(request.result);\n        };\n      };\n    });\n  }); // polyfill getAll\n\n  [Index, ObjectStore].forEach(function (Constructor) {\n    if (Constructor.prototype.getAll) return;\n\n    Constructor.prototype.getAll = function (query, count) {\n      var instance = this;\n      var items = [];\n      return new Promise(function (resolve) {\n        instance.iterateCursor(query, function (cursor) {\n          if (!cursor) {\n            resolve(items);\n            return;\n          }\n\n          items.push(cursor.value);\n\n          if (count !== undefined && items.length == count) {\n            resolve(items);\n            return;\n          }\n\n          cursor[\"continue\"]();\n        });\n      });\n    };\n  });\n\n  function openDb(name, version, upgradeCallback) {\n    var p = promisifyRequestCall(indexedDB, 'open', [name, version]);\n    var request = p.request;\n\n    if (request) {\n      request.onupgradeneeded = function (event) {\n        if (upgradeCallback) {\n          upgradeCallback(new UpgradeDB(request.result, event.oldVersion, request.transaction));\n        }\n      };\n    }\n\n    return p.then(function (db) {\n      return new DB(db);\n    });\n  }\n\n  function deleteDb(name) {\n    return promisifyRequestCall(indexedDB, 'deleteDatabase', [name]);\n  }\n\n  exports.openDb = openDb;\n  exports.deleteDb = deleteDb;\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n});","'use strict';\n// B.2.3.10 String.prototype.link(url)\nrequire('./_string-html')('link', function (createHTML) {\n  return function link(url) {\n    return createHTML(this, 'a', 'href', url);\n  };\n});\n","// 22.1.3.3 Array.prototype.copyWithin(target, start, end = this.length)\n'use strict';\nvar toObject = require('./_to-object');\nvar toAbsoluteIndex = require('./_to-absolute-index');\nvar toLength = require('./_to-length');\n\nmodule.exports = [].copyWithin || function copyWithin(target /* = 0 */, start /* = 0, end = @length */) {\n  var O = toObject(this);\n  var len = toLength(O.length);\n  var to = toAbsoluteIndex(target, len);\n  var from = toAbsoluteIndex(start, len);\n  var end = arguments.length > 2 ? arguments[2] : undefined;\n  var count = Math.min((end === undefined ? len : toAbsoluteIndex(end, len)) - from, len - to);\n  var inc = 1;\n  if (from < to && to < from + count) {\n    inc = -1;\n    from += count - 1;\n    to += count - 1;\n  }\n  while (count-- > 0) {\n    if (from in O) O[to] = O[from];\n    else delete O[to];\n    to += inc;\n    from += inc;\n  } return O;\n};\n"],"sourceRoot":""}